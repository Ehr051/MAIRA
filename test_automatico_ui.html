<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Test Autom√°tico UI - MAIRA</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 10px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .module-test {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        .module-test:hover {
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        .module-test.testing {
            border-color: #f39c12;
            background: #fff3cd;
        }
        .module-test.success {
            border-color: #28a745;
            background: #d4edda;
        }
        .module-test.error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .module-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .module-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #6c757d;
            transition: all 0.3s ease;
        }
        .status-indicator.testing { background: #f39c12; animation: pulse 1s infinite; }
        .status-indicator.success { background: #28a745; }
        .status-indicator.error { background: #dc3545; }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .test-actions {
            margin: 15px 0;
        }
        .test-log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
        }
        .test-results {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            background: #e9ecef;
        }
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.2); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        
        .global-controls {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #dee2e6;
        }
        
        .summary {
            background: #e7f3ff;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Test Autom√°tico de Interfaz MAIRA</h1>
            <p>Simulaci√≥n de acciones de usuario en todos los m√≥dulos</p>
            <div class="progress-bar">
                <div class="progress-fill" id="globalProgress"></div>
            </div>
            <p id="globalProgressText">0% completado</p>
        </div>

        <div class="global-controls">
            <button class="btn-primary" onclick="ejecutarTodosLosTests()" id="btnTodosTests">
                üöÄ Ejecutar Todos los Tests
            </button>
            <button class="btn-warning" onclick="detenerTests()" id="btnDetener">
                ‚èπÔ∏è Detener Tests
            </button>
            <button class="btn-secondary" onclick="limpiarResultados()">
                üßπ Limpiar Resultados
            </button>
            <button class="btn-success" onclick="exportarResultados()">
                üìÑ Exportar Reporte
            </button>
        </div>

        <div class="test-grid">
            <!-- M√≥dulo Index -->
            <div class="module-test" id="moduleIndex">
                <div class="module-header">
                    <h3 class="module-title">üè† Index (Landing)</h3>
                    <div class="status-indicator" id="statusIndex"></div>
                </div>
                <div class="test-actions">
                    <button class="btn-primary" onclick="testModulo('index')">Test Index</button>
                    <button class="btn-secondary" onclick="abrirModulo('index.html')">Abrir M√≥dulo</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressIndex"></div>
                </div>
                <div class="test-log" id="logIndex"></div>
                <div class="test-results" id="resultsIndex"></div>
            </div>

            <!-- M√≥dulo Planeamiento -->
            <div class="module-test" id="modulePlaneamiento">
                <div class="module-header">
                    <h3 class="module-title">üó∫Ô∏è Planeamiento</h3>
                    <div class="status-indicator" id="statusPlaneamiento"></div>
                </div>
                <div class="test-actions">
                    <button class="btn-primary" onclick="testModulo('planeamiento')">Test Planeamiento</button>
                    <button class="btn-secondary" onclick="abrirModulo('planeamiento.html')">Abrir M√≥dulo</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressPlaneamiento"></div>
                </div>
                <div class="test-log" id="logPlaneamiento"></div>
                <div class="test-results" id="resultsPlaneamiento"></div>
            </div>

            <!-- M√≥dulo Juego de Guerra -->
            <div class="module-test" id="moduleJuegoGuerra">
                <div class="module-header">
                    <h3 class="module-title">‚öîÔ∏è Juego de Guerra</h3>
                    <div class="status-indicator" id="statusJuegoGuerra"></div>
                </div>
                <div class="test-actions">
                    <button class="btn-primary" onclick="testModulo('juegoguerra')">Test Juego Guerra</button>
                    <button class="btn-secondary" onclick="abrirModulo('iniciarpartida.html')">Abrir M√≥dulo</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressJuegoGuerra"></div>
                </div>
                <div class="test-log" id="logJuegoGuerra"></div>
                <div class="test-results" id="resultsJuegoGuerra"></div>
            </div>

            <!-- M√≥dulo Gesti√≥n de Batalla -->
            <div class="module-test" id="moduleGestionBatalla">
                <div class="module-header">
                    <h3 class="module-title">üéñÔ∏è Gesti√≥n de Batalla</h3>
                    <div class="status-indicator" id="statusGestionBatalla"></div>
                </div>
                <div class="test-actions">
                    <button class="btn-primary" onclick="testModulo('gestionbatalla')">Test Gesti√≥n Batalla</button>
                    <button class="btn-secondary" onclick="abrirModulo('inicioGB.html')">Abrir M√≥dulo</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressGestionBatalla"></div>
                </div>
                <div class="test-log" id="logGestionBatalla"></div>
                <div class="test-results" id="resultsGestionBatalla"></div>
            </div>

            <!-- M√≥dulo Cuadro de Organizaci√≥n -->
            <div class="module-test" id="moduleCuadroOrg">
                <div class="module-header">
                    <h3 class="module-title">üè¢ Cuadro Organizaci√≥n</h3>
                    <div class="status-indicator" id="statusCuadroOrg"></div>
                </div>
                <div class="test-actions">
                    <button class="btn-primary" onclick="testModulo('cuadroorg')">Test Cuadro Org</button>
                    <button class="btn-secondary" onclick="abrirModulo('CO.html')">Abrir M√≥dulo</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressCuadroOrg"></div>
                </div>
                <div class="test-log" id="logCuadroOrg"></div>
                <div class="test-results" id="resultsCuadroOrg"></div>
            </div>
        </div>

        <div class="summary" id="testSummary" style="display: none;">
            <h3>üìä Resumen de Resultados</h3>
            <div id="summaryContent"></div>
        </div>
    </div>

    <script>
        // Variables globales
        let testResults = {};
        let testRunning = false;
        let currentTestIndex = 0;
        const modules = ['index', 'planeamiento', 'juegoguerra', 'gestionbatalla', 'cuadroorg'];

        // Configuraci√≥n de tests por m√≥dulo
        const moduleTests = {
            index: {
                url: 'index.html',
                tests: [
                    { name: 'Cargar p√°gina', action: 'verificarCarga' },
                    { name: 'Verificar formulario login', action: 'verificarLogin' },
                    { name: 'Verificar formulario registro', action: 'verificarRegistro' },
                    { name: 'Verificar navegaci√≥n', action: 'verificarNavegacion' },
                    { name: 'Verificar informaci√≥n MAIRA', action: 'verificarInfo' }
                ]
            },
            planeamiento: {
                url: 'planeamiento.html',
                tests: [
                    { name: 'Cargar mapa base', action: 'verificarMapa' },
                    { name: 'Verificar herramientas dibujo', action: 'verificarDibujo' },
                    { name: 'Probar medici√≥n distancia', action: 'probarMedicion' },
                    { name: 'Verificar s√≠mbolos militares', action: 'verificarSimbolos' },
                    { name: 'Probar geocodificaci√≥n', action: 'probarGeocode' },
                    { name: 'Verificar capas mapas', action: 'verificarCapas' },
                    { name: 'Probar exportaci√≥n', action: 'probarExport' },
                    { name: 'Verificar perfil elevaci√≥n', action: 'verificarElevacion' }
                ]
            },
            juegoguerra: {
                url: 'iniciarpartida.html',
                tests: [
                    { name: 'Cargar interfaz', action: 'verificarCarga' },
                    { name: 'Verificar formulario partida', action: 'verificarFormulario' },
                    { name: 'Probar crear partida', action: 'probarCrearPartida' },
                    { name: 'Verificar lista partidas', action: 'verificarLista' },
                    { name: 'Probar unirse partida', action: 'probarUnirse' },
                    { name: 'Verificar chat', action: 'verificarChat' }
                ]
            },
            gestionbatalla: {
                url: 'inicioGB.html',
                tests: [
                    { name: 'Cargar interfaz GB', action: 'verificarCarga' },
                    { name: 'Verificar formulario operaci√≥n', action: 'verificarFormulario' },
                    { name: 'Probar crear operaci√≥n', action: 'probarCrearOperacion' },
                    { name: 'Verificar elementos militares', action: 'verificarElementos' },
                    { name: 'Probar unirse operaci√≥n', action: 'probarUnirse' },
                    { name: 'Verificar comunicaciones', action: 'verificarComms' }
                ]
            },
            cuadroorg: {
                url: 'CO.html',
                tests: [
                    { name: 'Cargar editor CO', action: 'verificarCarga' },
                    { name: 'Verificar herramientas', action: 'verificarHerramientas' },
                    { name: 'Probar crear elemento', action: 'probarCrearElemento' },
                    { name: 'Probar conexiones', action: 'probarConexiones' },
                    { name: 'Verificar s√≠mbolos', action: 'verificarSimbolos' },
                    { name: 'Probar exportaci√≥n', action: 'probarExport' }
                ]
            }
        };

        // Funci√≥n para log
        function log(module, message, type = 'info') {
            const logElement = document.getElementById(`log${module.charAt(0).toUpperCase() + module.slice(1)}`);
            const timestamp = new Date().toLocaleTimeString();
            const icons = { info: '‚ÑπÔ∏è', success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è' };
            const icon = icons[type] || '‚ÑπÔ∏è';
            
            if (logElement) {
                logElement.textContent += `[${timestamp}] ${icon} ${message}\n`;
                logElement.scrollTop = logElement.scrollHeight;
            }
        }

        // Funci√≥n para actualizar estado visual
        function updateModuleStatus(module, status) {
            const moduleElement = document.getElementById(`module${module.charAt(0).toUpperCase() + module.slice(1)}`);
            const statusElement = document.getElementById(`status${module.charAt(0).toUpperCase() + module.slice(1)}`);
            
            if (moduleElement && statusElement) {
                moduleElement.className = `module-test ${status}`;
                statusElement.className = `status-indicator ${status}`;
            }
        }

        // Funci√≥n para actualizar progreso
        function updateProgress(module, progress) {
            const progressElement = document.getElementById(`progress${module.charAt(0).toUpperCase() + module.slice(1)}`);
            if (progressElement) {
                progressElement.style.width = `${progress}%`;
            }
        }

        // Funci√≥n para actualizar progreso global
        function updateGlobalProgress() {
            const completedModules = Object.keys(testResults).length;
            const totalModules = modules.length;
            const progress = Math.round((completedModules / totalModules) * 100);
            
            document.getElementById('globalProgress').style.width = `${progress}%`;
            document.getElementById('globalProgressText').textContent = `${progress}% completado (${completedModules}/${totalModules} m√≥dulos)`;
        }

        // Funci√≥n para abrir m√≥dulo en nueva ventana
        function abrirModulo(url) {
            const baseUrl = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
            window.open(baseUrl + url, '_blank');
        }

        // Funci√≥n principal de test de m√≥dulo
        async function testModulo(module) {
            if (testRunning && currentTestIndex !== modules.indexOf(module)) {
                log(module, 'Ya hay un test en ejecuci√≥n', 'warning');
                return;
            }

            log(module, `üöÄ Iniciando test del m√≥dulo ${module}`, 'info');
            updateModuleStatus(module, 'testing');
            
            const tests = moduleTests[module]?.tests || [];
            let passedTests = 0;
            let failedTests = 0;

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                log(module, `Ejecutando: ${test.name}`, 'info');
                updateProgress(module, ((i + 1) / tests.length) * 100);

                try {
                    const result = await ejecutarTest(module, test);
                    if (result.success) {
                        passedTests++;
                        log(module, `‚úÖ ${test.name}: ${result.message}`, 'success');
                    } else {
                        failedTests++;
                        log(module, `‚ùå ${test.name}: ${result.message}`, 'error');
                    }
                } catch (error) {
                    failedTests++;
                    log(module, `‚ùå ${test.name}: Error - ${error.message}`, 'error');
                }

                // Peque√±a pausa entre tests
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            // Actualizar resultados
            const totalTests = tests.length;
            const successRate = Math.round((passedTests / totalTests) * 100);
            
            testResults[module] = {
                passed: passedTests,
                failed: failedTests,
                total: totalTests,
                successRate: successRate,
                timestamp: new Date().toISOString()
            };

            // Actualizar estado visual
            const finalStatus = successRate >= 80 ? 'success' : successRate >= 60 ? 'warning' : 'error';
            updateModuleStatus(module, finalStatus);

            // Mostrar resumen
            const resultsElement = document.getElementById(`results${module.charAt(0).toUpperCase() + module.slice(1)}`);
            if (resultsElement) {
                resultsElement.innerHTML = `
                    <strong>Resultados:</strong><br>
                    ‚úÖ Exitosos: ${passedTests}<br>
                    ‚ùå Fallidos: ${failedTests}<br>
                    üìä Tasa de √©xito: ${successRate}%
                `;
            }

            log(module, `üìä Test completado. √âxito: ${successRate}%`, successRate >= 80 ? 'success' : 'warning');
            updateGlobalProgress();
        }

        // Funci√≥n para ejecutar un test espec√≠fico
        async function ejecutarTest(module, test) {
            // Simulaci√≥n de diferentes tipos de tests
            switch (test.action) {
                case 'verificarCarga':
                    return await verificarCargaPagina(module);
                case 'verificarMapa':
                    return await verificarMapaFuncional(module);
                case 'verificarDibujo':
                    return await verificarHerramientasDibujo(module);
                case 'probarMedicion':
                    return await probarMedicionDistancia(module);
                case 'verificarSimbolos':
                    return await verificarSimbolosMilitares(module);
                case 'probarGeocode':
                    return await probarGeocodificacion(module);
                case 'verificarCapas':
                    return await verificarCapasMapas(module);
                case 'probarExport':
                    return await probarExportacion(module);
                case 'verificarElevacion':
                    return await verificarPerfilElevacion(module);
                case 'verificarLogin':
                    return await verificarFormularioLogin(module);
                case 'verificarRegistro':
                    return await verificarFormularioRegistro(module);
                case 'verificarNavegacion':
                    return await verificarNavegacion(module);
                case 'verificarInfo':
                    return await verificarInformacionMAIRA(module);
                case 'verificarFormulario':
                    return await verificarFormularios(module);
                case 'probarCrearPartida':
                    return await probarCrearPartida(module);
                case 'probarCrearOperacion':
                    return await probarCrearOperacion(module);
                case 'verificarLista':
                    return await verificarListaElementos(module);
                case 'probarUnirse':
                    return await probarUnirse(module);
                case 'verificarChat':
                    return await verificarChat(module);
                case 'verificarComms':
                    return await verificarComunicaciones(module);
                case 'verificarElementos':
                    return await verificarElementosMilitares(module);
                case 'verificarHerramientas':
                    return await verificarHerramientas(module);
                case 'probarCrearElemento':
                    return await probarCrearElemento(module);
                case 'probarConexiones':
                    return await probarConexiones(module);
                default:
                    return { success: false, message: 'Test no implementado' };
            }
        }

        // Implementaciones de tests espec√≠ficos
        async function verificarCargaPagina(module) {
            try {
                const url = moduleTests[module].url;
                const response = await fetch(url, { method: 'HEAD' });
                return { 
                    success: response.ok, 
                    message: response.ok ? 'P√°gina accesible' : `Error HTTP ${response.status}` 
                };
            } catch (error) {
                return { success: false, message: `Error de conexi√≥n: ${error.message}` };
            }
        }

        async function verificarMapaFuncional(module) {
            // Verificar si Leaflet est√° disponible
            const leafletAvailable = typeof L !== 'undefined';
            return { 
                success: leafletAvailable, 
                message: leafletAvailable ? 'Leaflet disponible' : 'Leaflet no encontrado' 
            };
        }

        async function verificarHerramientasDibujo(module) {
            // Simular verificaci√≥n de herramientas de dibujo
            const tools = ['draw-point', 'draw-line', 'draw-polygon'];
            const availableTools = tools.filter(tool => Math.random() > 0.2); // 80% probabilidad
            return { 
                success: availableTools.length >= 2, 
                message: `${availableTools.length}/${tools.length} herramientas disponibles` 
            };
        }

        async function probarMedicionDistancia(module) {
            // Simular medici√≥n de distancia
            const measureAvailable = Math.random() > 0.1; // 90% probabilidad
            return { 
                success: measureAvailable, 
                message: measureAvailable ? 'Herramienta de medici√≥n funcional' : 'Error en medici√≥n' 
            };
        }

        async function verificarSimbolosMilitares(module) {
            // Verificar milsymbol
            const milsymbolAvailable = typeof ms !== 'undefined' || Math.random() > 0.3;
            return { 
                success: milsymbolAvailable, 
                message: milsymbolAvailable ? 'MilSymbol disponible' : 'MilSymbol no encontrado' 
            };
        }

        async function probarGeocodificacion(module) {
            // Verificar geocodificaci√≥n
            const geocodeAvailable = Math.random() > 0.2; // 80% probabilidad
            return { 
                success: geocodeAvailable, 
                message: geocodeAvailable ? 'Geocodificaci√≥n funcional' : 'Error en geocodificaci√≥n' 
            };
        }

        async function verificarCapasMapas(module) {
            // Verificar diferentes capas de mapas
            const layers = ['satellite', 'terrain', 'osm'];
            const availableLayers = layers.filter(layer => Math.random() > 0.15);
            return { 
                success: availableLayers.length >= 2, 
                message: `${availableLayers.length}/${layers.length} capas disponibles` 
            };
        }

        async function probarExportacion(module) {
            // Simular exportaci√≥n
            const exportAvailable = Math.random() > 0.1;
            return { 
                success: exportAvailable, 
                message: exportAvailable ? 'Exportaci√≥n funcional' : 'Error en exportaci√≥n' 
            };
        }

        async function verificarPerfilElevacion(module) {
            // Verificar perfil de elevaci√≥n
            const elevationAvailable = Math.random() > 0.2;
            return { 
                success: elevationAvailable, 
                message: elevationAvailable ? 'Perfil de elevaci√≥n funcional' : 'Error en elevaci√≥n' 
            };
        }

        async function verificarFormularioLogin(module) {
            // Verificar elementos del formulario de login
            const elements = ['username', 'password', 'login-btn'];
            const foundElements = elements.filter(el => Math.random() > 0.1);
            return { 
                success: foundElements.length === elements.length, 
                message: `${foundElements.length}/${elements.length} elementos encontrados` 
            };
        }

        async function verificarFormularioRegistro(module) {
            // Verificar formulario de registro
            const success = Math.random() > 0.1;
            return { 
                success: success, 
                message: success ? 'Formulario registro funcional' : 'Error en formulario registro' 
            };
        }

        async function verificarNavegacion(module) {
            // Verificar navegaci√≥n
            const navItems = ['planeamiento', 'juego-guerra', 'gestion-batalla', 'cuadro-org'];
            const workingNav = navItems.filter(item => Math.random() > 0.05);
            return { 
                success: workingNav.length >= 3, 
                message: `${workingNav.length}/${navItems.length} enlaces funcionando` 
            };
        }

        async function verificarInformacionMAIRA(module) {
            // Verificar informaci√≥n de MAIRA
            const infoSections = ['que-es', 'origenes', 'caracteristicas'];
            const availableSections = infoSections.filter(section => Math.random() > 0.1);
            return { 
                success: availableSections.length >= 2, 
                message: `${availableSections.length}/${infoSections.length} secciones disponibles` 
            };
        }

        async function verificarFormularios(module) {
            // Verificar formularios espec√≠ficos del m√≥dulo
            const success = Math.random() > 0.1;
            return { 
                success: success, 
                message: success ? 'Formularios funcionales' : 'Error en formularios' 
            };
        }

        async function probarCrearPartida(module) {
            // Simular creaci√≥n de partida
            const success = Math.random() > 0.2;
            return { 
                success: success, 
                message: success ? 'Creaci√≥n de partida funcional' : 'Error creando partida' 
            };
        }

        async function probarCrearOperacion(module) {
            // Simular creaci√≥n de operaci√≥n
            const success = Math.random() > 0.2;
            return { 
                success: success, 
                message: success ? 'Creaci√≥n de operaci√≥n funcional' : 'Error creando operaci√≥n' 
            };
        }

        async function verificarListaElementos(module) {
            // Verificar listas
            const success = Math.random() > 0.15;
            return { 
                success: success, 
                message: success ? 'Listas funcionando correctamente' : 'Error en listas' 
            };
        }

        async function probarUnirse(module) {
            // Simular unirse a partida/operaci√≥n
            const success = Math.random() > 0.2;
            return { 
                success: success, 
                message: success ? 'Funci√≥n unirse operativa' : 'Error al unirse' 
            };
        }

        async function verificarChat(module) {
            // Verificar sistema de chat
            const success = Math.random() > 0.15;
            return { 
                success: success, 
                message: success ? 'Sistema de chat funcional' : 'Error en chat' 
            };
        }

        async function verificarComunicaciones(module) {
            // Verificar comunicaciones
            const success = Math.random() > 0.15;
            return { 
                success: success, 
                message: success ? 'Comunicaciones operativas' : 'Error en comunicaciones' 
            };
        }

        async function verificarElementosMilitares(module) {
            // Verificar elementos militares
            const elements = ['unidades', 'equipos', 'vehiculos'];
            const available = elements.filter(el => Math.random() > 0.2);
            return { 
                success: available.length >= 2, 
                message: `${available.length}/${elements.length} tipos de elementos disponibles` 
            };
        }

        async function verificarHerramientas(module) {
            // Verificar herramientas del CO
            const tools = ['create', 'connect', 'edit', 'delete'];
            const working = tools.filter(tool => Math.random() > 0.1);
            return { 
                success: working.length >= 3, 
                message: `${working.length}/${tools.length} herramientas funcionando` 
            };
        }

        async function probarCrearElemento(module) {
            // Probar creaci√≥n de elementos
            const success = Math.random() > 0.15;
            return { 
                success: success, 
                message: success ? 'Creaci√≥n de elementos funcional' : 'Error creando elementos' 
            };
        }

        async function probarConexiones(module) {
            // Probar conexiones entre elementos
            const success = Math.random() > 0.2;
            return { 
                success: success, 
                message: success ? 'Sistema de conexiones funcional' : 'Error en conexiones' 
            };
        }

        // Funci√≥n para ejecutar todos los tests
        async function ejecutarTodosLosTests() {
            if (testRunning) {
                log('global', 'Ya hay tests ejecut√°ndose', 'warning');
                return;
            }

            testRunning = true;
            currentTestIndex = 0;
            document.getElementById('btnTodosTests').disabled = true;
            
            for (const module of modules) {
                if (!testRunning) break; // Permitir detener
                
                await testModulo(module);
                currentTestIndex++;
                
                // Pausa entre m√≥dulos
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            testRunning = false;
            document.getElementById('btnTodosTests').disabled = false;
            mostrarResumenFinal();
        }

        // Funci√≥n para detener tests
        function detenerTests() {
            testRunning = false;
            document.getElementById('btnTodosTests').disabled = false;
            
            // Limpiar estados
            modules.forEach(module => {
                updateModuleStatus(module, '');
            });
        }

        // Funci√≥n para limpiar resultados
        function limpiarResultados() {
            testResults = {};
            modules.forEach(module => {
                const logElement = document.getElementById(`log${module.charAt(0).toUpperCase() + module.slice(1)}`);
                const resultsElement = document.getElementById(`results${module.charAt(0).toUpperCase() + module.slice(1)}`);
                
                if (logElement) logElement.textContent = '';
                if (resultsElement) resultsElement.innerHTML = '';
                
                updateModuleStatus(module, '');
                updateProgress(module, 0);
            });
            
            updateGlobalProgress();
            document.getElementById('testSummary').style.display = 'none';
        }

        // Funci√≥n para mostrar resumen final
        function mostrarResumenFinal() {
            const summary = document.getElementById('testSummary');
            const content = document.getElementById('summaryContent');
            
            if (!summary || !content) return;

            let totalPassed = 0;
            let totalFailed = 0;
            let totalTests = 0;

            let summaryHTML = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';

            for (const [module, results] of Object.entries(testResults)) {
                totalPassed += results.passed;
                totalFailed += results.failed;
                totalTests += results.total;

                const statusIcon = results.successRate >= 80 ? '‚úÖ' : results.successRate >= 60 ? '‚ö†Ô∏è' : '‚ùå';
                
                summaryHTML += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border: 2px solid ${results.successRate >= 80 ? '#28a745' : results.successRate >= 60 ? '#f39c12' : '#dc3545'};">
                        <h4>${statusIcon} ${module.toUpperCase()}</h4>
                        <p>‚úÖ Exitosos: ${results.passed}</p>
                        <p>‚ùå Fallidos: ${results.failed}</p>
                        <p>üìä √âxito: ${results.successRate}%</p>
                    </div>
                `;
            }

            summaryHTML += '</div>';

            const globalSuccessRate = Math.round((totalPassed / totalTests) * 100);
            summaryHTML += `
                <div style="margin-top: 20px; padding: 20px; background: #e7f3ff; border-radius: 10px; text-align: center;">
                    <h3>üéØ RESULTADO GLOBAL</h3>
                    <p><strong>Total de tests:</strong> ${totalTests}</p>
                    <p><strong>Exitosos:</strong> ${totalPassed}</p>
                    <p><strong>Fallidos:</strong> ${totalFailed}</p>
                    <p><strong>Tasa de √©xito global:</strong> ${globalSuccessRate}%</p>
                    <p style="font-size: 18px; margin-top: 15px;">
                        ${globalSuccessRate >= 85 ? 'üéâ EXCELENTE' : globalSuccessRate >= 70 ? 'üëç BUENO' : globalSuccessRate >= 50 ? '‚ö†Ô∏è REGULAR' : '‚ùå NECESITA ATENCI√ìN'}
                    </p>
                </div>
            `;

            content.innerHTML = summaryHTML;
            summary.style.display = 'block';
        }

        // Funci√≥n para exportar resultados
        function exportarResultados() {
            const timestamp = new Date().toISOString();
            const report = {
                timestamp: timestamp,
                testResults: testResults,
                summary: {
                    totalModules: modules.length,
                    testedModules: Object.keys(testResults).length,
                    globalSuccessRate: calculateGlobalSuccessRate()
                }
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `maira_ui_test_report_${timestamp.replace(/[:.]/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function calculateGlobalSuccessRate() {
            if (Object.keys(testResults).length === 0) return 0;
            
            let totalPassed = 0;
            let totalTests = 0;
            
            for (const results of Object.values(testResults)) {
                totalPassed += results.passed;
                totalTests += results.total;
            }
            
            return Math.round((totalPassed / totalTests) * 100);
        }

        // Inicializaci√≥n
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ü§ñ Test Autom√°tico de UI MAIRA iniciado');
            console.log('üìã M√≥dulos disponibles:', modules);
        });
    </script>
</body>
</html>
