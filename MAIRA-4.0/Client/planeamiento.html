<!DOCTYPE html>

<head>
  <title>Modo Planeamiento</title>
  <link rel="apple-touch-icon" sizes="180x180" href="image/favicon_logoai/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="image/favicon_logoai/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="image/favicon_logoai/favicon-16x16.png">
    <link rel="manifest" href="image/favicon_logoai/site.webmanifest">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- ‚úÖ FIX: Font Awesome 6.4.0 (misma versi√≥n que juegodeguerra.html) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">

  <!-- Estilos CSS -->
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="../node_modules/leaflet-draw/dist/leaflet.draw.css" />
  <link rel="stylesheet" href="../node_modules/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <link rel="stylesheet" href="../node_modules/@raruto/leaflet-elevation/dist/leaflet-elevation.css" />
  <link rel="stylesheet" href="../node_modules/leaflet-fullscreen/dist/leaflet.fullscreen.css" />
  <link rel="stylesheet" href="../node_modules/leaflet-sidebar-v2/css/leaflet-sidebar.min.css" />
  <link rel="stylesheet" href="../node_modules/leaflet-measure/dist/leaflet-measure.css" />
  <link rel="stylesheet" href="../node_modules/leaflet-easybutton/src/easy-button.css" />
  
  <link rel="stylesheet" href="css/common/planeamiento.css">
  <link rel="stylesheet" href="css/common/CYGMarcha.css">
  <link rel="stylesheet" href="css/common/graficomarcha.css">

  <script src="js/common/networkConfig.js"></script>
  <!-- Scripts JavaScript -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="../node_modules/jspdf/dist/jspdf.umd.min.js"></script>
  <script src="../node_modules/html2canvas/dist/html2canvas.min.js"></script>
  
  <script src="../node_modules/leaflet/dist/leaflet.js"></script>
  <script src="../node_modules/milsymbol/dist/milsymbol.js"></script>
  <script src="../node_modules/d3/dist/d3.min.js"></script>
  <script src="../node_modules/@raruto/leaflet-elevation/dist/leaflet-elevation.min.js"></script>
  <script src="../node_modules/leaflet-draw/dist/leaflet.draw.js"></script>
  <script src="../node_modules/leaflet-geometryutil/src/leaflet.geometryutil.js"></script>
  <script src="../node_modules/leaflet-geosearch/dist/bundle.min.js"></script>
  <script src="../node_modules/geotiff/dist-browser/geotiff.js"></script>
  <script src="../node_modules/leaflet-control-geocoder/dist/Control.Geocoder.min.js"></script>
  <script src="../node_modules/proj4/dist/proj4.js"></script>
  <!-- <script src="../node_modules/leaflet-utfgrid/L.UTFGrid-min.js"></script> -->
  
  <!-- Three.js para visualizaci√≥n 3D - Sistema de carga robusto -->
  <script>
    // Sistema de carga de THREE.js con CDN fallback
    (function() {
      if (typeof THREE !== 'undefined') {
        console.log('‚úÖ THREE.js ya est√° disponible');
        return;
      }

      console.log('üîÑ Cargando THREE.js...');

      // Funci√≥n para cargar dependencias despu√©s de THREE.js
      function loadThreeDependencies() {
        // Cargar GLTFLoader
        if (typeof THREE.GLTFLoader === 'undefined') {
          var gltfScript = document.createElement('script');
          gltfScript.src = 'Libs/mythree/GLTFLoader.js';
          gltfScript.onload = function() {
            console.log('‚úÖ GLTFLoader cargado');
          };
          gltfScript.onerror = function() {
            console.error('‚ùå Error cargando GLTFLoader');
          };
          document.head.appendChild(gltfScript);
        }

        // Cargar OrbitControls
        var orbitScript = document.createElement('script');
        orbitScript.src = 'Libs/mythree/OrbitControlsBrowser.js';
        orbitScript.onload = function() {
          console.log('‚úÖ OrbitControls cargado');
        };
        orbitScript.onerror = function() {
          console.error('‚ùå Error cargando OrbitControls');
        };
        document.head.appendChild(orbitScript);
      }

      // Intentar CDN primero
      var threeScript = document.createElement('script');
      threeScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
      threeScript.onload = function() {
        console.log('‚úÖ THREE.js cargado desde CDN');
        loadThreeDependencies();
      };
      threeScript.onerror = function() {
        console.log('‚ö†Ô∏è CDN fall√≥, intentando local...');
        // Fallback a local
        var localScript = document.createElement('script');
        localScript.src = 'Libs/mythree/three.min.js';
        localScript.onload = function() {
          console.log('‚úÖ THREE.js cargado desde local');
          loadThreeDependencies();
        };
        localScript.onerror = function() {
          console.error('‚ùå Error cargando THREE.js desde local');
        };
        document.head.appendChild(localScript);
      };
      document.head.appendChild(threeScript);
    })();
  </script>

  <!-- ECOSISTEMA 3D COMPLETO - Componentes del sistema unificado -->
  <script src="js/modules/gaming/modelos3DManager.js"></script>
  <script src="js/modules/gaming/elementoModelo3DMapper.js"></script>
  <script src="js/modules/gaming/sidcModelo3DBridge.js"></script>
  <script src="js/modules/gaming/sistemaJerarquicoSIDC.js"></script>
  <script src="js/modules/gaming/sistemaFormacionesMilitares.js"></script>
  <script src="js/modules/gaming/tactico3dIntegration.js"></script>
  <script src="js/modules/gaming/visorMapa3DMejorado.js"></script>
  <script src="js/modules/gaming/sistemaTerrenoRealista.js"></script>

  <!-- SISTEMA MAESTRO 3D - Integra todo el ecosistema -->
  <script src="js/services/maira3DMaster.js"></script>
  <!-- Three.js GLTFLoader cargado din√°micamente arriba -->
  
  <!-- M√≥dulos MAIRA 4.0 -->
  <!-- <script src="js/modules/sistema3d.js"></script> ELIMINADO - Conflicto con threeDMapService -->
  <script src="js/modules/paneles.js"></script>
  <script src="js/modules/planeamiento.js"></script>
  <!-- Three.js OrbitControls cargado din√°micamente arriba -->
  
  <!-- Socket.IO desde node_modules local -->
  <script src="../node_modules/socket.io/client-dist/socket.io.min.js"></script>
  
  <!-- Three.js cargado desde /Libs/three-js/ - Sin dependencias externas -->
  <!-- Pako.js para descompresi√≥n de TIF en tar.gz -->
  <script src="../node_modules/pako/dist/pako.min.js"></script>
  
  <script type="module">
    import * as mgrs from '/node_modules/mgrs/mgrs.js';
    window.mgrs = mgrs;
  </script>
  <script src="../node_modules/leaflet.gridlayer.googlemutant/dist/Leaflet.GoogleMutant.js"></script>
  <script src="../node_modules/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <script src="../node_modules/leaflet-measure/dist/leaflet-measure.js"></script>
  <script src="../node_modules/leaflet-easybutton/src/easy-button.js"></script>
  <script src="../node_modules/leaflet-fullscreen/dist/Leaflet.fullscreen.min.js"></script>
  <script src="../node_modules/leaflet-bing-layer/leaflet-bing-layer.min.js"></script>
  <script src="../node_modules/leaflet-polylinedecorator/dist/leaflet.polylineDecorator.js"></script>
  <script src="../node_modules/leaflet-sidebar-v2/js/leaflet-sidebar.min.js"></script>
  <script src="../node_modules/leaflet-search/dist/leaflet-search.src.js"></script>
  <script src="../node_modules/file-saver/dist/FileSaver.js"></script>
  <script src="Libs/Leaflet.pattern-master/dist/leaflet.pattern.js"></script>

  <!-- Scripts personalizados -->
  <!-- Core y utilidades -->
  <script src="js/core/UserIdentity.js"></script>
  <script src="js/utils/sessionManager.js"></script>
  
  <!-- Infraestructura -->
  <script src="js/infrastructure/terrainAdapter.js"></script>
  
  <!-- üÜï SISTEMA GEOESPACIAL UNIFICADO v4.0 (Optimizado con Workers, Cache, Batch) -->
  <script src="js/services/GeospatialDataService.js"></script>
  <script src="js/services/ElevationService.js"></script>
  <script src="js/services/VegetationService.js"></script>
  <script src="js/adapters/ElevationAdapter.js"></script>
  <script src="js/adapters/VegetationAdapter.js"></script>
  <script src="js/init/geospatialInit.js"></script>

  <!-- Servicios -->
  <script src="js/services/servicesManager.js"></script>
  <script src="js/services/transitabilityService.js"></script>
  <script src="js/services/slopeAnalysisService.js"></script>
  <script src="js/services/elevationProfileService.js"></script>
  <script src="js/services/threeDMapService.js"></script>
  <script src="js/modules/shared/sistemaZoomMultiNivel.js"></script>
  
  <!-- Handlers de terreno -->
  <!-- <script src="js/workers/elevation.worker.js"></script> --> <!-- Workers se cargan din√°micamente -->
  <script src="js/handlers/elevationHandler.js"></script>
  <script src="js/handlers/vegetacionhandler.js"></script>
  
  <!-- Handlers refactorizados -->
  <script src="js/utils/geometryUtils.js"></script>
  <script src="js/handlers/mobileOptimizationHandler.js"></script>
  <script src="js/handlers/mapInteractionHandler.js"></script>
  <script src="js/handlers/measurementHandler.js"></script>
  

  <!-- Element Editor - FUNCI√ìN CR√çTICA PARA EDICI√ìN - MOVIDO A edicioncompleto.js -->
  <script src="js/handlers/performanceOptimizer.js"></script>
  <script src="js/handlers/EventBus.js"></script>
  <script src="js/handlers/pendienteHandler.js"></script>
  <script src="js/handlers/transitabilidadHandler.js"></script>
  <script src="js/handlers/searchHandler.js"></script>
  <script src="js/handlers/testHandler.js"></script>
  

  <!-- Common -->
  <script src="js/common/mapaP.js"></script>
  <script src="js/utils/calcosP.js"></script>
  <script src="js/common/simbolosP.js"></script>
  <script src="js/common/herramientasP.js"></script>
  <script src="js/common/fontAwesomeTest.js"></script>
  <script src="js/common/toolsInitializer.js"></script>
  <script src="js/common/dibujosMCCP.js"></script>
  <script src="js/common/edicioncompleto.js"></script>
  <script src="js/common/atajosP.js"></script>
  <script src="js/common/unidades.js"></script>
  <script src="js/common/partidas.js"></script>
  
  <script src="js/common/CalculoMarcha.js"></script>
  <script src="js/common/graficoMarcha.js"></script>
  <script src="js/common/panelMarcha.js"></script>
  <script src="js/common/miradial.js"></script>
  
  <!-- Sistema de Men√∫ Radial MAIRA -->
  <link rel="stylesheet" href="css/common/mairaRadialMenu.css">
  <script src="js/common/mairaRadialMenu.js"></script>
  
  <!-- M√≥dulos espec√≠ficos -->
  <script src="js/modules/planeamiento/planeamiento.js"></script>
  <script src="js/common/indexP.js"></script>
  
  <!-- Script de verificaci√≥n -->
  <script src="js/Test/testPlaneamiento.js"></script>
  <script src="js/Test/autoTest.js"></script>
  <script src="js/Test/visualizadorTests.js"></script>

</head>

<body class="maira-planeamiento">

<div id="botones-principales">
  <div class="menu-btn">
    <button id="verBtn" data-toggle="collapse" data-target="#ver-menu" aria-expanded="false" aria-controls="ver-menu">
      <i class="fas fa-eye" id="fa-eye-icon"></i> Ver
    </button>
    <div id="ver-menu" class="menu collapse">
      <div class="menu-btn">
        <button id="tipoMapaBtn" onclick="toggleMenu('collapse')">Tipo de Mapa</button>
        <div id="collapse" class="collapse">
          <a href="#" data-map-type="osm"><i class="fas fa-mountain"></i> Terreno</a>
          <a href="#" data-map-type="calles"><i class="fas fa-road"></i> Calles</a>
          <a href="#" data-map-type="satelite"><i class="fas fa-satellite-dish"></i> Sat√©lite</a>
          <a href="#" data-map-type="Transport"><i class="fas fa-bus"></i> Transport</a>
          <a href="#" data-map-type="Landscape"><i class="fas fa-mountain"></i> Landscape</a>
          <a href="#" data-map-type="Outdoors"><i class="fas fa-tree"></i> Outdoors</a>
        </div>
      </div>
      <div class="menu-btn">
        <button onclick="toggleMenu('cuadriculasBtn')">Cuadr√≠culas</button>
        <div id="cuadriculasBtn" class="collapse">
          <div class="menu-btn">
            <button onclick="toggleMenu('tipoCuadriculaBtn')">Tipo de Cuadr√≠cula</button>
            <div id="tipoCuadriculaBtn" class="collapse">
              <button id="cuadriculaMGRS" onclick="cambiarCuadricula('MGRS')">MGRS</button>
              <button id="cuadriculaUTM" onclick="cambiarCuadricula('UTM')">UTM</button>
              <button id="cuadriculaWGS84" onclick="cambiarCuadricula('WGS84')">WGS84</button>
              <button id="cuadriculaPlana" onclick="cambiarCuadricula('Planas')">Planas</button>
              <button id="cuadriculaNinguna" onclick="cambiarCuadricula('Ninguna')">Ninguna</button>
              </div>
            </div>
          <div class="opacity-slider">
            <label for="opacitySlider">Transparencia</label>
            <input type="range" min="0" max="100" value="50" id="opacitySlider">
          </div>
          <div class="grid-width-slider">
            <label for="gridWidthSlider">Ancho de L√≠nea</label>
            <input type="range" min="1" max="10" value="2" id="gridWidthSlider">
          </div>
          <div class="color-selector">
            <label for="colorSelector">Color</label>
            <input type="color" id="colorSelector" value="#000000">
          </div>
        </div>
        <span>coordenadas del cursor</span>
        <div id="gridControls"></div>
        <label class="switch">
          <input type="checkbox" id="coordenadasCheckbox">
          <span class="slider round"></span>
        </label> </label>
      </div>
    </div>
  </div>
  <div class="menu-btn">
    <button id="herramientasBtn" data-toggle="collapse" data-target="#herramientas-menu" aria-expanded="false"
      aria-controls="herramientas-menu">
      <i class="fas fa-tools" id="fa-tools-icon"></i> Herramientas
    </button>
    <div id="herramientas-menu" class="menu collapse">
      <div id="search-container">
        <div class="search-input-wrapper">
            <input type="text" id="busquedaLugar" placeholder="Buscar lugar...">
            <button id="btnBuscarLugar" type="buscarlugar"><i class="fas fa-search"></i></button>
        </div>
        <ul id="resultadosBusquedaLugar"></ul>
      </div>
        <a href="#" id="btnMedirDistancia"><i class="fas fa-ruler-combined"></i> Medir Distancia</a>
        <a href="#" id="PerfilElevacionBtn"><i class="fas fa-chart-line"></i> Perfil de Elevaci√≥n</a>
        <a href="#" id="btnVista3D"><i class="fas fa-cube" id="fa-cube-icon"></i> Vista 3D</a>
        <a href="#" id="btnCalculoMarcha" ><i class="fas fa-route"></i>C√°lculo de Marcha</a>
        <a href="#" id="btnControlGestos"><i class="fas fa-hand-paper"></i> Control por Gestos</a>
      </div>
  </div>
  <div class="menu-btn"> 
    <button onclick="toggleMenu('agregar-menu')"><i class="fas fa-plus"> </i> Agregar Elemento</button>
    <div id="agregar-menu" class="menu collapse">
    <div class="botones-fuerza">
      <button onclick="actualizarSidc('F')">Amigo</button>
      <button onclick="actualizarSidc('J')">Enemigo</button>
    </div>
    <div id="search-container">
      <div class="search-input-wrapper">
        <input type="text" id="busquedaSimbolo" placeholder="Buscar Simbolo...">
        <button id="btnBuscarSimbolo" type="button"><i class="fas fa-search"></i></button>
      </div>
      <ul id="resultadosBusquedaSimbolos"></ul>
    </div>
    <div class="menu-btn">
      <button onclick="toggleMenu('simbolosBasicosBtn')">S√≠mbolos B√°sicos</button>
      <div id="simbolosBasicosBtn" class="collapse">
        <div class="sidc-container">
          <div class="menu-btn">
            <button onclick="toggleMenu('basicos')">Generales</button>
            <div id="basicos" class="collapse submenu simbolo-grid"> 
              <a href="#" data-sidc="SFGPUH----" onclick="agregarMarcador(this.dataset.sidc, 'Puesto Comando')"><span
                  class="mil-symbol"></span> Puesto Comando </a>
              <a href="#" data-sidc="SFGPU-----" onclick="agregarMarcador(this.dataset.sidc, 'Elemento B√°sico')"><span
              class="mil-symbol"></span> Elemento B√°sico</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="menu-btn">
      <button onclick="toggleMenu('infanteriaBtn')">Infanter√≠a</button>
      <div id="infanteriaBtn" class="collapse submenu">
        <div class="sidc-container">
          <a href="#" data-sidc="SFGPUCI---" onclick="agregarMarcador(this.dataset.sidc, 'infanteria')"><span
              class="mil-symbol"></span> Infanter√≠a</a>
          <a href="#" data-sidc="SFGPUCAA--" onclick="agregarMarcador(this.dataset.sidc, 'Antitanque')"><span
              class="mil-symbol"></span> Antitanque</a>
        </div>
        <div class="menu-btn">
          <button onclick="toggleMenu('infanteriaArmamentoBtn')">Armamento</button>
          <div id="infanteriaArmamentoBtn" class="collapse submenu simbolo-grid">
            <a href="#" data-sidc="SFGPEWR---" onclick="agregarMarcador(this.dataset.sidc, 'Arma B√°sica o FAL')"><span
                class="mil-symbol"></span> FAL</a>
            <a href="#" data-sidc="SFGPEWRR--"
              onclick="agregarMarcador(this.dataset.sidc, 'Fusil Autom√°tico Pesado (FAP)')"><span
                class="mil-symbol"></span> FAP</a>
            <a href="#" data-sidc="SFGPEWRL--"
              onclick="agregarMarcador(this.dataset.sidc, 'Ametralladora Pesada')"><span class="mil-symbol"></span>
              Ametralladora Pesada</a>
            <a href="#" data-sidc="SFGPEWA---" onclick="agregarMarcador(this.dataset.sidc, 'Arma Antia√©rea')"><span
                class="mil-symbol"></span> Arma Antia√©rea</a>
            <a href="#" data-sidc="SFGPEWAM--"
              onclick="agregarMarcador(this.dataset.sidc, 'Ametralladora Pesada Antia√©rea')"><span
                class="mil-symbol"></span> Ametralladora Pesada Antia√©rea</a>
            <a href="#" data-sidc="SFGPEWD---" onclick="agregarMarcador(this.dataset.sidc, 'Ca√±√≥n Antitanque')"><span
                class="mil-symbol"></span> Ca√±√≥n Antitanque</a>
            <a href="#" data-sidc="SFGPEWG---"
              onclick="agregarMarcador(this.dataset.sidc, 'Arma Antitanque (corto alcance)')"><span
                class="mil-symbol"></span> Arma Antitanque (corto alcance)</a>
            <a href="#" data-sidc="SFGPEWGM--"
              onclick="agregarMarcador(this.dataset.sidc, 'Arma Antitanque (largo alcance)')"><span
                class="mil-symbol"></span> Arma Antitanque (largo alcance)</a>
            <a href="#" data-sidc="SFGPEWM---" onclick="agregarMarcador(this.dataset.sidc, 'Lanzacohetes')"><span
                class="mil-symbol"></span> Lanzacohetes</a>
            <a href="#" data-sidc="SFGPEWO---" onclick="agregarMarcador(this.dataset.sidc, 'Mortero Liviano')"><span
                class="mil-symbol"></span> Mortero Liviano</a>
            <a href="#" data-sidc="SFGPEWOM--" onclick="agregarMarcador(this.dataset.sidc, 'Mortero Mediano')"><span
                class="mil-symbol"></span> Mortero Mediano</a>
            <a href="#" data-sidc="SFGPEWOH--" onclick="agregarMarcador(this.dataset.sidc, 'Mortero Pesado')"><span
                class="mil-symbol"></span> Mortero Pesado</a>
          </div>
        </div>
        <div class="menu-btn">
          <button onclick="toggleMenu('infanteriaVehiculosBtn')">Veh√≠culos</button>
          <div id="infanteriaVehiculosBtn" class="collapse submenu simbolo-grid">
            <a href="#" data-sidc="SFGPEVAI--"
              onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo Blindado a Rueda')"><span class="mil-symbol"></span>
              Veh√≠culo Blindado a Rueda</a>
          </div>
        </div>
      </div>
    </div>

    <div class="menu-btn">
      <button onclick="toggleMenu('caballeriaBtn')">Caballer√≠a</button>
      <div id="caballeriaBtn" class="collapse submenu">
        <div class="sidc-container">
          <a href="#" data-sidc="SFGPUCR---" onclick="agregarMarcador(this.dataset.sidc, 'Caballer√≠a')"><span
              class="mil-symbol"></span> Caballer√≠a</a>
        </div>
        <div class="menu-btn">
          <button onclick="toggleMenu('caballeriaArmamentoBtn')">Armamento</button>
          <div id="caballeriaArmamentoBtn" class="collapse submenu simbolo-grid">
            <a href="#" data-sidc="SFGPEWR---" onclick="agregarMarcador(this.dataset.sidc, 'Arma B√°sica o FAL')"><span
                class="mil-symbol"></span> FAL</a>
            <a href="#" data-sidc="SFGPEWRR--"
              onclick="agregarMarcador(this.dataset.sidc, 'Fusil Autom√°tico Pesado (FAP)')"><span
                class="mil-symbol"></span> FAP</a>
            <a href="#" data-sidc="SFGPEWRL--"
              onclick="agregarMarcador(this.dataset.sidc, 'Ametralladora Pesada')"><span class="mil-symbol"></span>
              Ametralladora Pesada</a>
            <a href="#" data-sidc="SFGPEWA---" onclick="agregarMarcador(this.dataset.sidc, 'Arma Antia√©rea')"><span
                class="mil-symbol"></span> Arma Antia√©rea</a>
            <a href="#" data-sidc="SFGPEWAM--"
              onclick="agregarMarcador(this.dataset.sidc, 'Ametralladora Pesada Antia√©rea')"><span
                class="mil-symbol"></span> Ametralladora Pesada Antia√©rea</a>
            <a href="#" data-sidc="SFGPEWD---" onclick="agregarMarcador(this.dataset.sidc, 'Ca√±√≥n Antitanque')"><span
                class="mil-symbol"></span> Ca√±√≥n Antitanque</a>
            <a href="#" data-sidc="SFGPEWG---"
              onclick="agregarMarcador(this.dataset.sidc, 'Arma Antitanque (corto alcance)')"><span
                class="mil-symbol"></span> Arma Antitanque (corto alcance)</a>
            <a href="#" data-sidc="SFGPEWGM--"
              onclick="agregarMarcador(this.dataset.sidc, 'Arma Antitanque (largo alcance)')"><span
                class="mil-symbol"></span> Arma Antitanque (largo alcance)</a>
            <a href="#" data-sidc="SFGPEWM---" onclick="agregarMarcador(this.dataset.sidc, 'Lanzacohetes')"><span
                class="mil-symbol"></span> Lanzacohetes</a>
            <a href="#" data-sidc="GFGPDPOR--"
              onclick="agregarMarcador(this.dataset.sidc, 'Observador Adelantado')"><span class="mil-symbol"></span></a>
            <a href="#" data-sidc="SFGPEWO---" onclick="agregarMarcador(this.dataset.sidc, 'Mortero Liviano')"><span
                class="mil-symbol"></span> Mortero Liviano</a>
            <a href="#" data-sidc="SFGPEWOM--" onclick="agregarMarcador(this.dataset.sidc, 'Mortero Mediano')"><span
                class="mil-symbol"></span> Mortero Mediano</a>
            <a href="#" data-sidc="SFGPEWOH--" onclick="agregarMarcador(this.dataset.sidc, 'Mortero Pesado')"><span
                class="mil-symbol"></span> Mortero Pesado</a>
          </div>
        </div>
        <div class="menu-btn">
          <button onclick="toggleMenu('caballeriaVehiculosBtn')">Veh√≠culos</button>
          <div id="caballeriaVehiculosBtn" class="collapse submenu simbolo-grid">
            <a href="#" data-sidc="SFGPEVAI--"
              onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo a Blindado Rueda')"><span class="mil-symbol"></span>
              Veh√≠culo a Rueda</a>
            <a href="#" data-sidc="SFGPEVAT--"
              onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo Blindado a Oruga o Semioruga (b√°sico)')"><span
                class="mil-symbol"></span> Veh√≠culo Blindado a Oruga o Semioruga (b√°sico)</a>
            <a href="#" data-sidc="SFGPEVATM-"
              onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo Blindado a Rueda')"><span class="mil-symbol"></span>
              Veh√≠culo Blindado a Rueda</a>
            <a href="#" data-sidc="SFGPEVATH-"
              onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo Blindado a Rueda de Exploraci√≥n (mediano)')"><span
                class="mil-symbol"></span> Veh√≠culo Blindado a Rueda de Exploraci√≥n (mediano)</a>
          </div>
        </div>
      </div>
    </div>

    <div class="menu-btn">
      <button onclick="toggleMenu('apoyoFuegoBtn')">Apoyo de Fuego</button>
      <div id="apoyoFuegoBtn" class="collapse submenu sidc-container">
        <a href="#" data-sidc="SFGPUCF---" onclick="agregarMarcador(this.dataset.sidc, 'Artiller√≠a')"><span class="mil-symbol"></span> Artiller√≠a</a>
        <a href="#" data-sidc="GFGPDPOF--" onclick="agregarMarcador(this.dataset.sidc, 'Observador adelantado de Artilleria')"><span class="mil-symbol"></span> Observador Adelantado de Artileria</a>
        <div class="menu-btn">
          <button onclick="toggleMenu('artilleriaCampanaBtn')">Artiller√≠a de Campa√±a</button>
          <div id="artilleriaCampanaBtn" class="collapse submenu simbolo-grid sidc-container">
            <a href="#" data-sidc="SFGPEWH---"
              onclick="agregarMarcador(this.dataset.sidc, 'Ob√∫s Liviano (cal 105mm)')"><span class="mil-symbol"></span>
              Ob√∫s Liviano (cal 105mm)</a>
            <a href="#" data-sidc="SFGPEWHM--"
              onclick="agregarMarcador(this.dataset.sidc, 'Ob√∫s Mediano (cal 155mm)')"><span class="mil-symbol"></span>
              Ob√∫s Mediano (cal 155mm)</a>
            <a href="#" data-sidc="SFGPEWHH--"
              onclick="agregarMarcador(this.dataset.sidc, 'Ob√∫s Pesado (cal 240mm)')"><span class="mil-symbol"></span>
              Ob√∫s Pesado (cal 240mm)</a>
            <a href="#" data-sidc="SFGPEWD---" onclick="agregarMarcador(this.dataset.sidc, 'Ca√±√≥n Liviano')"><span
                class="mil-symbol"></span> Ca√±√≥n Liviano</a>
            <a href="#" data-sidc="SFGPEWDL--" onclick="agregarMarcador(this.dataset.sidc, 'Ca√±√≥n Mediano')"><span
                class="mil-symbol"></span> Ca√±√≥n Mediano</a>
            <a href="#" data-sidc="SFGPEWDM--" onclick="agregarMarcador(this.dataset.sidc, 'Ca√±√≥n Pesado')"><span
                class="mil-symbol"></span> Ca√±√≥n Pesado</a>
            <a href="#" data-sidc="SFGPEWG---"
              onclick="agregarMarcador(this.dataset.sidc, 'Ca√±√≥n Liviano Antitanque')"><span class="mil-symbol"></span>
              Ca√±√≥n Liviano Antitanque</a>
            <a href="#" data-sidc="SFGPEWDLS-"
              onclick="agregarMarcador(this.dataset.sidc, 'Ca√±√≥n Mediano Autopropulsado')"><span
                class="mil-symbol"></span> Ca√±√≥n Mediano Autopropulsado</a>
          </div>
        </div>

        <div class="menu-btn">
          <button onclick="toggleMenu('artilleriaAntiareaBtn')">Artiller√≠a Antia√©rea</button>
          <div id="artilleriaAntiareaBtn" class="collapse submenu simbolo-grid sidc-container">
            <a href="#" data-sidc="SFGPEWA---"
              onclick="agregarMarcador(this.dataset.sidc, 'Ca√±√≥n de Artiller√≠a Antia√©rea')"><span
                class="mil-symbol"></span> Ca√±√≥n de Artiller√≠a Antia√©rea</a>
            <a href="#" data-sidc="SFGPEWAL--"
              onclick="agregarMarcador(this.dataset.sidc, 'Proyectil Autopropulsado Superficie-Aire')"><span
                class="mil-symbol"></span> Proyectil Autopropulsado Superficie-Aire</a>
          </div>
        </div>
      </div>
    </div>
          <div class="menu-btn">
              <button onclick="toggleMenu('apoyoCombateBtn')">Apoyo de Combate</button>
              <div id="apoyoCombateBtn" class="collapse submenu simbolo-grid">
                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Ingenieros')" data-sidc="SFGPUCE---"><span class="mil-symbol"></span>Ingenieros</a>
                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Comunicaciones')" data-sidc="SFGPUUS---"><span class="mil-symbol"></span>Comunicaciones</a>         
                  <div class="menu-btn">
                      <button onclick="toggleMenu('ingenierosBtn')">Ingenieros</button>
                      <div id="ingenierosBtn" class="collapse submenu">
                        <div class="menu-btn">
                          <button onclick="toggleMenu('ingenierosVehiculosEquiposBtn')">Veh√≠culos y Equipos</button>
                          <div id="ingenierosVehiculosEquiposBtn" class="collapse submenu simbolo-grid">
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo de Combate Lanzapuentes')" data-sidc="SFGPEVEB--"><span class="mil-symbol"></span>Veh√≠culo de Combate Lanzapuentes</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo de Ingenieros')" data-sidc="SFGPEVE---"><span class="mil-symbol"></span>Veh√≠culo de Ingenieros</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo de Apertura de Brecha')" data-sidc="SFGPEVC---"><span class="mil-symbol"></span>Veh√≠culo de Apertura de Brecha</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo de Desminado')" data-sidc="SFGPEVUL--"><span class="mil-symbol"></span>Veh√≠culo de Desminado</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo de Movilidad')" data-sidc="SFGPEVM---"><span class="mil-symbol"></span>Veh√≠culo de Movilidad</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Veh√≠culo Utilitario')" data-sidc="SFGPEVU---"><span class="mil-symbol"></span>Veh√≠culo Utilitario</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Bulldozer')" data-sidc="SFGPEVUB--"><span class="mil-symbol"></span>Bulldozer</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Rodillo')" data-sidc="SFGPEVUR--"><span class="mil-symbol"></span>Rodillo</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Excavadora')" data-sidc="SFGPEVUE--"><span class="mil-symbol"></span>Excavadora</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Cargador')" data-sidc="SFGPEVUL--"><span class="mil-symbol"></span>Cargador</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Gr√∫a')" data-sidc="SFGPEVUX--"><span class="mil-symbol"></span>Gr√∫a</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Volquete')" data-sidc="SFGPEVUT--"><span class="mil-symbol"></span>Volquete</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Cami√≥n Cisterna')" data-sidc="SFGPEVUT--"><span class="mil-symbol"></span>Cami√≥n Cisterna</a>
                              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Buscaminas')" data-sidc="SFGPEVUSL-"><span class="mil-symbol"></span>Buscaminas</a>
                          </div>
                      </div>
                          <div class="menu-btn">
                              <button onclick="toggleMenu('ingenierosMovilidadBtn')">Movilidad</button>
                              <div id="ingenierosMovilidadBtn" class="collapse submenu simbolo-grid">
                                <a href="#" onclick="dibujarElemento('linea', 'GFGPGLR---', 'Camino Bueno')">Camino Bueno</a>
                                <a href="#" onclick="dibujarElemento('linea', 'GFGPGLR---', 'Camino Malo')">Camino Malo</a>
                                <a href="#" onclick="dibujarElemento('linea', 'GFGPGLR---', 'Camino Pavimentado')">Camino Pavimentado</a>
                                <a href="#" onclick="dibujarElemento('linea', 'GFGPGLR---', 'Camino de Tierra')">Camino de Tierra</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Puente')" data-sidc="GFMPBCB---"><span class="mil-symbol"></span>Puente</a>
                                <a href="#" onclick="dibujarElemento('linea', 'GFGPGLL---', 'Curso de Agua')">Curso de Agua</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Vado')" data-sidc="GFMPBCF---"><span class="mil-symbol"></span>Vado</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Compuerta')" data-sidc="GFMPBCA---"><span class="mil-symbol"></span>Compuerta</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'T√∫nel')" data-sidc="GFMPBCT---"><span class="mil-symbol"></span>T√∫nel</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Paso a Nivel')" data-sidc="GFMPBCP---"><span class="mil-symbol"></span>Paso a Nivel</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Punto de Embarque')" data-sidc="GFGPGPE---"><span class="mil-symbol"></span>Punto de Embarque</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Punto de Desembarque')" data-sidc="GFGPGPD---"><span class="mil-symbol"></span>Punto de Desembarque</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Helipuerto')" data-sidc="GFGPGAH---"><span class="mil-symbol"></span>Helipuerto</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Aer√≥dromo')" data-sidc="GFGPGAA---"><span class="mil-symbol"></span>Aer√≥dromo</a>
                            </div>
                          </div>         
                          <div class="menu-btn">
                            <button onclick="toggleMenu('ingenierosContramovilidadBtn')">Contramovilidad</button>
                              <div id="ingenierosContramovilidadBtn" class="collapse submenu simbolo-grid">
                                  <a href="#" onclick="dibujarElemento('poligono', 'GFMPOAD---', 'Zona de Demoliciones')">Zona de Demoliciones</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Obst√°culo')" data-sidc="GFMPOB----"><span class="mil-symbol"></span>Obst√°culo</a>
                                  <a href="#" onclick="dibujarElemento('linea', 'GFMPOF----', 'Campo Minado')">Campo Minado</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Mina Antitanque')" data-sidc="GFMPOMD---"><span class="mil-symbol"></span>Mina Antitanque</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Mina Antipersonal')" data-sidc="GFMPOME---"><span class="mil-symbol"></span>Mina Antipersonal</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Mina Antitanque de Circunstancia')" data-sidc="GFMPOMW---"><span class="mil-symbol"></span>Mina Antitanque de Circunstancia</a>
                              </div>
                          </div>          
                          <div class="menu-btn">
                            <button onclick="toggleMenu('ingenierosProteccionBtn')">Protecci√≥n</button>
                            <div id="ingenierosProteccionBtn" class="collapse submenu simbolo-grid">
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Fortificaci√≥n')" data-sidc="GFMPSF----"><span class="mil-symbol"></span>Fortificaci√≥n</a>
                                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Muro')" data-sidc="GFMPSE----"><span class="mil-symbol"></span>Muro</a>
                              </div>
                          </div>
                      </div>
                  </div>          
                  <div class="menu-btn">
                      <button onclick="toggleMenu('comunicacionesBtn')">Comunicaciones</button>
                      <div id="comunicacionesBtn" class="collapse submenu">
                          <div class="menu-btn">
                              <button onclick="toggleMenu('comunicacionesComandosBtn')">Comandos, Elementos y Centros</button>
                              <div id="comunicacionesComandosBtn" class="collapse submenu simbolo-grid">
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Comando de Comunicaciones')" data-sidc="SFGPUCCS--"><span class="mil-symbol"></span>Comando de Comunicaciones</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Batall√≥n de Comunicaciones')" data-sidc="SFGPUCCB--"><span class="mil-symbol"></span>Batall√≥n de Comunicaciones</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Batall√≥n de Telecomunicaciones')" data-sidc="SFGPUCCE--"><span class="mil-symbol"></span>Batall√≥n de Telecomunicaciones</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Batall√≥n de Operaciones Electr√≥nicas')" data-sidc="SFGPUCPF--"><span class="mil-symbol"></span>Batall√≥n de Operaciones Electr√≥nicas</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Compa√±√≠a de Comunicaciones')" data-sidc="SFGPUCCA--"><span class="mil-symbol"></span>Compa√±√≠a de Comunicaciones</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Escuadr√≥n de Comunicaciones')" data-sidc="SFGPUCCE--"><span class="mil-symbol"></span>Escuadr√≥n de Comunicaciones</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Centro de Comunicaciones (Comando Principal)')" data-sidc="SFGPUCPX--"><span class="mil-symbol"></span>Centro de Comunicaciones (Comando Principal)</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Centro de Comunicaciones (Comando Alternativo)')" data-sidc="SFGPUCPXA-"><span class="mil-symbol"></span>Centro de Comunicaciones (Comando Alternativo)</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Centro de Comunicaciones (Comando de Retaguardia)')" data-sidc="SFGPUCPXR-"><span class="mil-symbol"></span>Centro de Comunicaciones (Comando de Retaguardia)</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Puesto de Comunicaciones')" data-sidc="SFGPUCP---"><span class="mil-symbol"></span>Puesto de Comunicaciones</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Centro de Mensajes')" data-sidc="SFGPUCM---"><span class="mil-symbol"></span>Centro de Mensajes</a>
                              </div>
                          </div>          
                          <div class="menu-btn">
                              <button onclick="toggleMenu('radioelectricosBtn')">Radioel√©ctricos</button>
                              <div id="radioelectricosBtn" class="collapse submenu simbolo-grid">
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Equipo de Radio Vehicular')" data-sidc="SFG-UCRR--"><span class="mil-symbol"></span>Equipo de Radio Vehicular</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Equipo de Radiointerceptaci√≥n')" data-sidc="SFG-UCRR--"><span class="mil-symbol"></span>Equipo de Radiointerceptaci√≥n</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Equipo o Puesto de Integraci√≥n Radio a Radio')" data-sidc="SFG-UCRR--"><span class="mil-symbol"></span>Equipo o Puesto de Integraci√≥n Radio a Radio</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Estaci√≥n, Puesto o Equipo de Radio en General')" data-sidc="SFG-UCRR--"><span class="mil-symbol"></span>Estaci√≥n, Puesto o Equipo de Radio en General</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Repetidor de Radio')" data-sidc="SFG-UCRRT-"><span class="mil-symbol"></span>Repetidor de Radio</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Equipo de Integraci√≥n Radioal√°mbrica')" data-sidc="SFG-UCRRI-"><span class="mil-symbol"></span>Equipo de Integraci√≥n Radioal√°mbrica</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Equipo Radiorreceptor')" data-sidc="SFG-UCRR--"><span class="mil-symbol"></span>Equipo Radiorreceptor</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Estaci√≥n o Puesto Radiogoni√≥metro')" data-sidc="SFG-UCRRG-"><span class="mil-symbol"></span>Estaci√≥n o Puesto Radiogoni√≥metro</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Equipo, Estaci√≥n o Puesto de Radioteleimpresor')" data-sidc="SFG-UCRRT-"><span class="mil-symbol"></span>Equipo, Estaci√≥n o Puesto de Radioteleimpresor</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Puesto de Radiomulticanal')" data-sidc="SFG-UCRM--"><span class="mil-symbol"></span>Puesto de Radiomulticanal</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Repetidor de Radiomulticanal')" data-sidc="SFG-UCRMT-"><span class="mil-symbol"></span>Repetidor de Radiomulticanal</a>
                              </div>
                          </div>          
                          <div class="menu-btn">
                              <button onclick="toggleMenu('telefoniaBtn')">Telefon√≠a</button>
                              <div id="telefoniaBtn" class="collapse submenu simbolo-grid">
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Tel√©fono de Campa√±a a Magneto')" data-sidc="SFG-UCTCP-"><span class="mil-symbol"></span>Tel√©fono de Campa√±a a Magneto</a>
                                  <a href="#" onclick="dibujarElemento('linea', 'alambre-de-campana')">Alambre de Campa√±a (1 canal telef√≥nico)</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Central de Teleimpresores')" data-sidc="SFG-UCTCT-"><span class="mil-symbol"></span>Central de Teleimpresores</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Central Telef√≥nica (en un puesto de comando)')" data-sidc="SFG-UCTCP-"><span class="mil-symbol"></span>Central Telef√≥nica (en un puesto de comando)</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Central Telef√≥nica')" data-sidc="SFG-UCTCP-"><span class="mil-symbol"></span>Central Telef√≥nica</a>
                                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Teleimpresor')" data-sidc="SFG-UCTIT-"><span class="mil-symbol"></span>Teleimpresor</a>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <div class="menu-btn">
            <button onclick="toggleMenu('logisticaSanidadBtn')">Log√≠stica de Sanidad</button>
            <div id="logisticaSanidadBtn" class="collapse submenu simbolo-grid">
                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Sanidad')" data-sidc="SFGPUSM---"><span class="mil-symbol"></span>Sanidad</a>
                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Ambulancia')" data-sidc="EFOPAE----"><span class="mil-symbol"></span>Ambulancia</a>
                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Hospital Quir√≥fano M√≥vil')" data-sidc="SFGPUSMM--"><span class="mil-symbol"></span>Hospital Quir√≥fano M√≥vil</a>
            </div>
          </div>
          <div class="menu-btn">
            <button onclick="toggleMenu('logisticaMaterialBtn')">Log√≠stica de Material</button>
            <div id="logisticaMaterialBtn" class="collapse submenu">
              <div class="menu-btn">
                <button onclick="toggleMenu('intendenciaBtn')">Intendencia</button>
                <div id="intendenciaBtn" class="collapse submenu simbolo-grid">
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Instalaci√≥n de Intendencia')" data-sidc="GFSPPSZ---"><span class="mil-symbol"></span>Instalaci√≥n de Intendencia</a>
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Dep√≥sito de Intendencia (Clase II y IV)')" data-sidc="SFGPUSS---"><span class="mil-symbol"></span>Dep√≥sito de Intendencia (Clase II y IV)</a>
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Lugar de Distribuci√≥n de Efectos Clase I')" data-sidc="GFSPPSA---"><span class="mil-symbol"></span>Lugar de Distribuci√≥n de Efectos Clase I</a>
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Lugar de Abastecimiento de Efectos Clase III')" data-sidc="GFSPPSC---"><span class="mil-symbol"></span>Lugar de Abastecimiento de Efectos Clase III</a>
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Lugar de Reuni√≥n de Efectos Clase II y IV')" data-sidc="GFSPPSB---"><span class="mil-symbol"></span>Lugar de Reuni√≥n de Efectos Clase II y IV</a>
                    </div>
                  </div>
                <div class="menu-btn">
                  <button onclick="toggleMenu('arsenalesBtn')">Arsenales</button>
                  <div id="arsenalesBtn" class="collapse submenu simbolo-grid">
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Instalaci√≥n de Arsenales')" data-sidc="GFSPPSZ---"><span class="mil-symbol"></span>Instalaci√≥n de Arsenales</a>
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Lugar de Reuni√≥n')" data-sidc="GFSPPSZ---"><span class="mil-symbol"></span>Lugar de Reuni√≥n de Arsenales</a>
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Lugar de Distribuci√≥n de Munici√≥n')" data-sidc="GFSPPSZ---"><span class="mil-symbol"></span>Lugar de Distribuci√≥n de Munici√≥n</a>
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Lugar de Abastecimiento de Efectos Clase II y IV')" data-sidc="GFSPPSZ---"><span class="mil-symbol"></span>Lugar de Abastecimiento de Efectos Clase II y IV</a>
                        <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Lugar de Recolecci√≥n de Arsenales (Clase II y IV)')" data-sidc="GFSPPSZ---"><span class="mil-symbol"></span>Lugar de Recolecci√≥n de Arsenales (Clase II y IV)</a>
                    </div>
                </div>
            </div>
          </div>
          <div class="menu-btn">
            <button onclick="toggleMenu('transporteBtn')">Transporte</button>
            <div id="transporteBtn" class="collapse submenu simbolo-grid">
                <a href="#" onclick="dibujarElemento('linea', 'transito-alternado')">Tr√°nsito Alternado</a>
                <a href="#" onclick="dibujarElemento('linea', 'ruta-abierta')">Ruta Abierta</a>
                <a href="#" onclick="dibujarElemento('linea', 'ruta-supervisada')">Ruta Supervisada</a>
                <a href="#" onclick="dibujarElemento('linea', 'ruta-despacho')">Ruta de Despacho</a>
                <a href="#" onclick="dibujarElemento('linea', 'ruta-reservada')">Ruta Reservada</a>
                <a href="#" onclick="dibujarElemento('linea', 'limite-secciones-carreteras')">L√≠mite entre Secciones de Carreteras</a>
                <a href="#" onclick="dibujarElemento('linea', 'itinerario-guardado')">Itinerario Guardado</a>
                <a href="#" onclick="dibujarElemento('linea', 'seccion-carretera-intransitable')">Secci√≥n de Carretera Intransitable</a>
                <a href="#" onclick="dibujarElemento('linea', 'transito-mano-unica')">Tr√°nsito de Mano √önica</a>
                <a href="#" onclick="dibujarElemento('linea', 'transito-doble-mano')">Tr√°nsito de Doble Mano</a>
                <a href="#" onclick="dibujarElemento('linea', 'desvio')">Desv√≠o</a>
                </div>
          </div>
          <div class="menu-btn">
            <button onclick="toggleMenu('mccGeneralesBtn')">MCC</button>
            <div id="mccGeneralesBtn" class="collapse submenu simbolo-grid">
                <a href="#" onclick="dibujarElemento('poligono', 'SFFPAO----', 'Objetivo')">Objetivo</a>
                <a href="#" onclick="dibujarFlecha('flecha', 'Direcci√≥n de Ataque')">Direcci√≥n de Ataque</a>
                <a href="#" onclick="dibujarElemento('flechaAncha', 'GFGPOLAA--', 'Eje de Avance')">Eje de Avance</a>
                <a href="#" onclick="dibujarElemento('poligono', 'GFGPOAA---')">√Årea de Operaciones</a>
                <a href="#" onclick="dibujarElemento('linea', 'GFGPOLK---', 'L√≠nea de Coordinaci√≥n')">LLA</a>
                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'GFMPOGB---')">Bloqueo</a>
                <a href="#" onclick="dibujarElemento('linea', 'GFGPOLR---')">Retirada</a>
                <a href="#" onclick="dibujarElemento('linea', 'GFGPOLAA--')">L√≠mite de √Årea</a>
                <a href="#" onclick="dibujarElemento('poligono', 'GFGPOAR---')">Zona de Reuni√≥n</a>
                <a href="#" onclick="dibujarElemento('linea', 'limite-entre-dos-elementos')">L√≠mite entre dos elementos</a>
                <a href="#" onclick="dibujarElemento('linea', 'limite-dentro-de-un-objetivo')">L√≠mite dentro de un objetivo</a>
                <a href="#" onclick="dibujarElemento('linea', 'limite-exploracion-seguridad')">L√≠mite de Exploraci√≥n y Seguridad</a>
                <a href="#" onclick="dibujarElemento('linea', 'GFGPOLC---')">L√≠nea de Contacto (tropas amigas)</a>
                <a href="#" onclick="dibujarElemento('linea', 'LCFin')">L√≠nea de Coordinaci√≥n Final</a>
                <a href="#" onclick="dibujarElemento('linea', 'LPAtq')">L√≠nea de Partida para el Ataque</a>
                <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Bloqueo')" data-sidc="GFMPOGB---"><span class="mil-symbol"></span>Bloqueo</a>
                <a href="#" onclick="agregarPuntoControl('PC')"> Punto de Control (PC)</a>
                <a href="#" onclick="agregarPuntoControl('PI')">Punto Inicial (PI)</a>
                <a href="#" onclick="agregarPuntoControl('PT')">Punto Terminal (PT)</a>
                <a href="#" onclick="agregarPuntoControl('PD')">Punto de Desdoblamiento (PD)</a>
                <a href="#" onclick="agregarPuntoControl('PE')"> Punto de Encolumnamiento (PE)</a>
                <a href="#" onclick="agregarPuntoControl('PP')"> Punto de Pasaje (PP)</a>
  
              </div>
          </div>
          <div class="menu-btn">
            <button onclick="toggleMenu('fuegosBtn')">MCCF</button>
            <div id="fuegosBtn" class="collapse submenu simbolo-grid">
              <a href="#" onclick="dibujarElemento('poligono', 'G*F*ACSR--', '√Årea de Fuego Restringido (AFR)', {color: 'red', fillColor: 'red', fillPattern: 'diagonal'})">√Årea de Fuego Restringido (AFR)</a>
              <a href="#" onclick="dibujarElemento('poligono', 'G*F*ACNR--', '√Årea de NO Fuego (ANF)')">√Årea de NO Fuego (ANF)</a>
              <a href="#" onclick="dibujarElemento('linea', 'G*F*ATB---', 'Barrera')">Barrera</a>
              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Base Ac√∫stica')" data-sidc="S*G*USAS--"><span class="mil-symbol"></span>Base Ac√∫stica</a>
              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Base √ìptica')" data-sidc="S*G*USAO--"><span class="mil-symbol"></span>Base √ìptica</a>
              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Centro de Bater√≠a')" data-sidc="S*G*USAT--"><span class="mil-symbol"></span>Centro de Bater√≠a</a>
              <a href="#" onclick="dibujarElemento('poligono', 'G*F*AT----', 'Concentraci√≥n de Tiro')">Concentraci√≥n de Tiro</a>
              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Estaci√≥n Meteorol√≥gica')" data-sidc="S*G*USAM--"><span class="mil-symbol"></span>Estaci√≥n Meteorol√≥gica</a>
              <a href="#" onclick="dibujarElemento('linea', 'G*F*LT----', 'Grupo de Fuegos')">Grupo de Fuegos</a>
              <a href="#" onclick="dibujarElemento('linea', 'G*F*LCF---', 'L√≠nea de Coordinaci√≥n de Apoyo de Fuego (LCAF)')">L√≠nea de Coordinaci√≥n de Apoyo de Fuego (LCAF)</a>
              <a href="#" onclick="dibujarElemento('linea', 'G*F*LCC---', 'L√≠nea de Coordinaci√≥n y Seguridad de los Fuegos (LCSF)')">L√≠nea de Coordinaci√≥n y Seguridad de los Fuegos (LCSF)</a>
              <a href="#" onclick="dibujarElemento('linea', 'G*F*LCF---', 'L√≠nea de Coordinaci√≥n de los Fuegos (LCF)')">L√≠nea de Coordinaci√≥n de los Fuegos (LCF)</a>
              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Posici√≥n de Radar')" data-sidc="S*G*USAP--"><span class="mil-symbol"></span>Posici√≥n de Radar</a>
              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Puesto de Observaci√≥n')" data-sidc="GFGPDPO---"><span class="mil-symbol"></span>Puesto de Observaci√≥n</a>
              <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'PRB')" data-sidc="GFFPPTS---"><span class="mil-symbol"></span>Punto Registro Blanco</a>
              <a href="#" onclick="dibujarElemento('linea', 'G*F*LTS---', 'L√≠nea de Apertura de Fuego')">L√≠nea de Apertura de Fuego</a>
              <a href="#" onclick="dibujarElemento('poligono', 'G*F*AZFX--', 'Zona de Apoyo de Fuego (ZAF)')">Zona de Apoyo de Fuego (ZAF)</a>
              <a href="#" onclick="dibujarElemento('poligono', 'G*F*AZFX--', 'Zona de Fuego')">Zona de Fuego</a>
             
              <a href="#" onclick="dibujarElemento('poligono', 'G*F*AZXX--', 'Zona de Responsabilidad de Fuego Naval (ZRFN)')">Zona de Responsabilidad de Fuego Naval (ZRFN)</a>

            </div>
        </div>
        <div class="menu-btn">
          <button onclick="toggleMenu('toeBtn')">TOE (Tropas de Operaciones Especiales)</button>
          <div id="toeBtn" class="collapse submenu">
              <div class="menu-btn">
                  <button onclick="toggleMenu('comandosTOEBtn')">Comandos</button>
                  <div id="comandosTOEBtn" class="collapse submenu simbolo-grid">
                      <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Comando')" data-sidc="NONE"><span class="mil-symbol"></span>Comando</a>
                  </div>
              </div>
              <div class="menu-btn">
                <button onclick="toggleMenu('cazadoresBtn')">Cazadores</button>
                <div id="cazadoresBtn" class="collapse submenu simbolo-grid">
                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Cazador de Monte')" data-sidc="S*G*UCIZ--"><span class="mil-symbol"></span>Cazador de Monte</a>
                  <a href="#" onclick="agregarMarcador(this.dataset.sidc, 'Cazador de Monta√±a')" data-sidc="S*G*UCIZ--"><span class="mil-symbol"></span>Cazador de Monta√±a</a>
                </div>
              </div>
          </div>
        </div>
      </div>
    </div>
<div class="menu-btn">
  <button id="calcoBtn" data-toggle="collapse" data-target="#calcos-menu">
    <i class="fas fa-layer-group"></i> Calcos
  </button>
  <div id="calcos-menu" class="menu collapse">
    <div>
      <a href="#" id="nuevoCalcoBtn"><i class="fas fa-plus"></i> Nuevo Calco</a>
      <a href="#" id="cargarCalcoBtn"><i class="fas fa-upload"></i> Cargar Calco</a>
      <a href="#" id="guardarCalcoBtn"><i class="fas fa-save"></i> Guardar Calco</a>
      <a href="#" id="imprimirBtn"><i class="fas fa-print"></i> Imprimir</a>
    <div id="calcosLista">
      <!-- Aqu√≠ se agregar√°n los calcos din√°micamente -->
    </div>
  </div>
  </div>
</div>
<div class="menu-btn">
  <button id="ayudaBtn" data-toggle="collapse" data-target="#helpMenu" aria-expanded="false" aria-controls="helpMenu">
    <i class="fas fa-question"></i> Ayuda
  </button>
  <div id="helpMenu" class="menu collapse">
    <a href="#" id="documentacionBtn">
      <i class="fas fa-book"></i> Documentaci√≥n
    </a>
    <a href="#" id="atajosBtn">
      <i class="fas fa-keyboard"></i> Atajos de Teclado
    </a>
  </div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</header>
<main>
  <div id="mapContainer"></div>
  <div id="map" style="height: 100%;"></div>
  </div>
  <div>
    <button id="fullscreenBtn" class="fullscreen-button"><i class="fas fa-expand"></i></button>
  </div>
  <div id="botones-secundarios">
    <button id="btnDeshacer" onclick="deshacer()" disabled><i class="fas fa-undo-alt"></i></button>
    <button id="btnRehacer" onclick="rehacer()" disabled><i class="fas fa-redo-alt"></i></button>
    <button id="btnVolver" class="boton-volver"><i class="fas fa-arrow-left"></i></button>
  </div>
  <div id="coordenadas" class="coordenadas-display"></div>
  <div id="medicionDistancia" class="medicion-display">
    <span id="textoMedicion"></span>
    <button id="cerrarMedicion">X</button>
</div>
  
  <div id="panelEdicionLinea" class="panel">
    <h3>Editar L√≠nea</h3>
    <div>
        <label for="nombreLinea">Nombre:</label>
        <input type="text" id="nombreLinea">
    </div>
    <div>
        <label for="colorLinea">Color:</label>
        <input type="color" id="colorLinea">
    </div>
    <div>
        <label for="anchoLinea">Ancho:</label>
        <input type="number" id="anchoLinea" min="1" max="10">
    </div> 
    <div>
        <label for="tipoLinea">Tipo:</label>
        <select id="tipoLinea">
            <option value="solid">S√≥lida</option>
            <option value="dashed">Punteada</option>
        </select> 
    </div>
    <div class="panel-buttons">
        <button id="guardarCambiosLinea">Guardar Cambios</button>
        <button onclick="cerrarPanelEdicion('panelEdicionLinea')">Cerrar</button>
    </div>
    
</div>

<div id="panelEdicionUnidad" class="panel">
    <h3>Editar Unidad</h3>
    <div class="tab">
        <button class="tablinks" data-tab="SIDC">SIDC</button>
        <button class="tablinks" data-tab="Informacion">Informaci√≥n</button>
        <button class="tablinks" data-tab="Caracteristicas">Caracter√≠sticas</button>
    </div>

    <div id="sidcDisplay"></div>

    <div id="SIDC" class="tabcontent">
        <div>
            <label for="afiliacion">Afiliaci√≥n:</label>
            <select id="afiliacion">
                <option value="-">Desconocido</option>
                <option value="F">Amigo</option>
                <option value="J">Hostil/Enemigo</option>
            </select>
        </div>
        <div>
            <label for="estado">Estado:</label>
            <select id="estado">
                <option value="P">Presente</option>
                <option value="A">Planeado</option>
            </select>
        </div>
        <div>
            <label for="arma">Arma:</label>
            <select id="arma"></select>
        </div>
        <div>
            <label for="tipo">Tipo:</label>
            <select id="tipo"></select>
        </div>
        <div>
            <label for="caracteristica">Caracter√≠stica:</label>
            <select id="caracteristica"></select>
        </div>
        <div>
            <label for="tipoVehiculo">Tipo de Veh√≠culo:</label>
            <select id="tipoVehiculo">
                <option value="">Seleccionar tipo...</option>
            </select>
        </div>
        <div>
            <label for="magnitud">Magnitud:</label>
            <select id="magnitud">
                <option value="-">No especificado</option>
                <option value="A">Equipo/Tripulaci√≥n</option>
                <option value="B">peloton</option>
                <option value="C">grupo</option>
                <option value="D">Secci√≥n</option>
                <option value="E">Compa√±√≠a/Escuadr√≥n/Bater√≠a</option>
                <option value="F">Regimiento/Batall√≥n/Grupo</option>
                <option value="H">Brigada</option>
                    <option value="I">Divisi√≥n</option>
                    <option value="J">Cuerpo/MEF</option>
                    <option value="K">Ej√©rcito</option>
            </select>
        </div>
    </div>

    <div id="Informacion" class="tabcontent">
        <div>
            <label for="designacion">Designaci√≥n:</label>
            <input type="text" id="designacion">
        </div>
        <div>
            <label for="dependencia">Dependencia:</label>
            <input type="text" id="dependencia">
        </div>
    </div>

    <div id="Caracteristicas" class="tabcontent">
        <div>
            <input type="checkbox" id="puestoComando">
            <label for="puestoComando">Puesto de Comando</label>
        </div>
        <div>
            <input type="checkbox" id="fuerzaTarea">
            <label for="fuerzaTarea">Fuerza de Tarea</label>
        </div>
        <div>
            <input type="checkbox" id="reforzado">
            <label for="reforzado">Reforzado</label>
        </div>
        <div>
            <input type="checkbox" id="disminuido">
            <label for="disminuido">Disminuido</label>
        </div>
    </div>

    <div class="panel-buttons">
        <button id="guardarCambiosUnidad">Guardar Cambios</button>
        <button onclick="cerrarPanelEdicion('panelEdicionUnidad')">Cerrar</button>
    </div>
</div>

<div id="panelEdicionEquipo" class="panel">
    <h3>Editar Equipo</h3>
    
    <div id="sidcDisplayEquipo"></div>
    
    <div class="tab">
        <button class="tablinks" data-tab="SIDCEquipo">SIDC</button>
        <button class="tablinks" data-tab="InformacionEquipo">Informaci√≥n</button>
    </div>

    <div id="SIDCEquipo" class="tabcontent">
        <div>
            <label for="afiliacionEquipo">Afiliaci√≥n:</label>
            <select id="afiliacionEquipo">
                <option value="-">Desconocido</option>
                <option value="F">Amigo</option>
                <option value="J">Hostil/Enemigo</option>
            </select>
        </div>
        <div>
            <label for="tipoVehiculoEquipo" id="labelTipoEquipo">Tipo de Veh√≠culo:</label>
            <select id="tipoVehiculoEquipo">
                <option value="">Seleccionar tipo...</option>
            </select>
        </div>
    </div>

    <div id="InformacionEquipo" class="tabcontent">
        <div>
            <label for="designacionEquipo">Designaci√≥n:</label>
            <input type="text" id="designacionEquipo">
        </div>
        <div>
            <label for="asignacionEquipo">Asignaci√≥n:</label>
            <input type="text" id="asignacionEquipo">
        </div>
    </div>

    <div class="panel-buttons">
        <button id="guardarCambiosEquipo">Guardar Cambios</button>
        <button onclick="cerrarPanelEdicion('panelEdicionEquipo')">Cerrar</button>
    </div>
</div>

<div id="panelEdicionMCC" class="panel">
    <h3>Editar Elemento MCC</h3>
    <div>
        <label for="textoMCC">Texto:</label>
        <input type="text" id="textoMCC">
    </div>
    <div>
        <label for="colorMCC">Color:</label>
        <input type="color" id="colorMCC">
    </div>
    <div>
        <label for="anchoMCC">Ancho:</label>
        <input type="number" id="anchoMCC" min="1" max="10">
    </div>
    <div>
        <label for="colorRellenoMCC">Color de relleno:</label>
        <input type="color" id="colorRellenoMCC">
    </div>
    <div>
        <label for="tipoLineaMCC">Tipo de l√≠nea:</label>
        <select id="tipoLineaMCC">
            <option value="solid">S√≥lida</option>
            <option value="dashed">Punteada</option>
        </select>
    </div>
    <div id="rellenoMCC" style="display: none;">
        <label for="tipoRellenoMCC">Tipo de relleno:</label>
        <select id="tipoRellenoMCC">
          <option value="none">Sin relleno</option>
          <option value="solid">S√≥lido</option>
          <option value="diagonal">Diagonal</option>
          <option value="rombos">Rombos</option>
          <option value="cuadros">Cuadros</option>
          <option value="puntos">Puntos</option>
      </select>
    </div>
    <div class="panel-buttons">
        <button id="guardarCambiosMCC">Guardar Cambios</button>
        <button onclick="cerrarPanelEdicion('panelEdicionMCC')">Cerrar</button>
    </div>
  </div>

<!-- Panel principal de c√°lculo de marcha -->

<div id="panelMarchaContainer" style="display: none;"></div>

<!-- Panel Perfil de Elevaci√≥n -->
<div id="perfilElevacionDisplay" class="sub-panel" style="display: none;">
  <div class="display-header">
      <h3>Perfil de Elevaci√≥n</h3>
      <div class="display-controls">
          <button id="btnFullscreenElevation" class="btn-fullscreen" title="Pantalla completa">‚õ∂</button>
          <button id="btnSaveElevation" class="btn-save" title="Guardar">‚Üì</button>
          <button id="btnPrintElevation" class="btn-print" title="Imprimir">‚éô</button>
          <button id="elevation-close-button" class="btn-cerrar" onclick="cerrarPanel('perfilElevacionDisplay')">√ó</button>
      </div>
  </div>
  <div class="display-content" style="display: none;">
      <!-- Contenido del perfil de elevaci√≥n se cargar√° aqu√≠ -->
  </div>
</div>

<!-- Panel Gr√°fico de Marcha -->

<div id="graficoMarchaPanel" class="sub-panel" style="display: none;">
  <div class="display-header">
      <h3>Gr√°fico de Marcha</h3>
      <div class="display-controls">
          <button id="btnFullscreenGrafico" class="btn-fullscreen" title="Pantalla completa">‚õ∂</button>
          <button id="btnSaveGrafico" class="btn-save" title="Guardar">‚Üì</button>
          <button id="btnPrintGrafico" class="btn-print" title="Imprimir">‚éô</button>
          <button id="cerrarPanelGrafico" class="btn-cerrar">√ó</button>
      </div>
  </div>
  <div class="display-content">
      <!-- El gr√°fico D3 se insertar√° aqu√≠ -->
  </div>
</div>

<!-- Panel C√°lculo de Marcha -->
<div id="calculoMarchaPanel" class="sub-panel" style="display: none;">
  <div class="display-header">
      <h3>C√°lculo de Marcha</h3>
      <div class="display-controls">
          <button id="btnFullscreenCalculo" class="btn-fullscreen" title="Pantalla completa">‚õ∂</button>
          <button id="btnSaveCalculo" class="btn-save" title="Guardar">‚Üì</button>
          <button id="btnPrintCalculo" class="btn-print" title="Imprimir">‚éô</button>
          <button id="cerrarPanelCalculo" class="btn-cerrar" onclick="cerrarPanel('calculoMarchaPanel')">√ó</button>
      </div>
  </div>
  <div class="display-content" id="calculoMarchaContent">
      <!-- Contenido de c√°lculo de marcha se cargar√° aqu√≠ -->
  </div>
  <div id="detallesMarchaContainer" class="detalles-marcha-container"></div>
</div>

<!-- Contenedor para los detalles de la marcha -->

<!-- Script de inicializaci√≥n socket -->
<script>
// üîå INICIALIZAR SOCKET GLOBAL
try {
    if (typeof io !== 'undefined') {
        window.socket = io();
        console.log('‚úÖ Socket global inicializado');
    } else {
        console.warn('‚ö†Ô∏è Socket.IO no disponible');
    }
} catch(e) {
    console.warn('‚ö†Ô∏è Error inicializando socket:', e);
}
</script>

<!-- Script de inicializaci√≥n modular -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ MAIRA 4.0 - Inicializaci√≥n modular');
    
    // Inicializar sistemas modulares
    setTimeout(async function() {
        try {
            // 1. Inicializar Sistema de Planeamiento
            if (typeof inicializarSistemaPlaneamiento === 'function') {
                window.sistemaPl = inicializarSistemaPlaneamiento();
                console.log('‚úÖ Sistema de Planeamiento inicializado');
            }
            
            // 2. Inicializar Sistema 3D - UNIFICADO
            if (typeof toggleVista3D === 'function') {
                // threeDMapService disponible
                console.log('‚úÖ Sistema 3D unificado (threeDMapService) disponible');
            } else {
                console.warn('‚ö†Ô∏è Sistema 3D no disponible - threeDMapService no cargado');
            }
            
            // 3. Configurar eventos espec√≠ficos de planeamiento
            configurarEventosPlaneamiento();
            
            // 4. Verificar funcionalidades cr√≠ticas heredadas
            verificarFuncionalidadesCriticas();
            
        } catch (error) {
            console.error('‚ùå Error en inicializaci√≥n modular:', error);
        }
    }, 1000);
});

function configurarEventosPlaneamiento() {
    // Vista 3D
    const btnVista3D = document.getElementById('btnVista3D');
    if (btnVista3D) {
        btnVista3D.addEventListener('click', function(e) {
            e.preventDefault();
            // ‚úÖ USAR SISTEMA UNIFICADO MAIRA 3D MASTER
            if (window.maira3DSystem && typeof window.maira3DSystem.cambiarAVista3D === 'function') {
                window.maira3DSystem.cambiarAVista3D();
            } else {
                console.warn('‚ö†Ô∏è Sistema 3D MAIRA no disponible - maira3DMaster.js no cargado');
            }
        });
    }

    // Bot√≥n para cerrar vista 3D
    const btnCerrarVista3D = document.getElementById('cerrar-vista3d');
    if (btnCerrarVista3D) {
        btnCerrarVista3D.addEventListener('click', function(e) {
            e.preventDefault();
            if (window.maira3DSystem && window.maira3DSystem.deactivate) {
                window.maira3DSystem.deactivate();
            }
        });
    }

    // Detector de gestos
    const btnControlGestos = document.getElementById('btnControlGestos');
    if (btnControlGestos) {
        btnControlGestos.addEventListener('click', function(e) {
            e.preventDefault();
            descargarDetectorGestos();
        });
    }
    
    console.log('‚úÖ Eventos de planeamiento configurados');
}

function verificarFuncionalidadesCriticas() {
    const funcionesCriticas = [
        'medirDistancia',
        'toggleMenu', 
        'seleccionarElemento',
        'finalizarMedicion',
        'obtenerJugadorPropietario'
    ];
    
    let funcionesOK = 0;
    funcionesCriticas.forEach(func => {
        if (typeof window[func] === 'function') {
            funcionesOK++;
        }
    });
    
    console.log(`üìä Funciones heredadas: ${funcionesOK}/${funcionesCriticas.length}`);
    
    // Inicializar men√∫ radial
    if (typeof window.MiRadial !== 'undefined' && window.map) {
        setTimeout(() => {
            try {
                window.MiRadial.init(window.map);
                console.log('‚úÖ Men√∫ radial inicializado');
            } catch(e) {
                console.warn('‚ö†Ô∏è Error men√∫ radial:', e);
            }
        }, 2000);
    }
}

// ‚úÖ FUNCI√ìN CONFLICTIVA ELIMINADA - toggleVista3DModular()
// Solo usar threeDMapService.toggleVista3D() que funciona correctamente
function toggleVista3DModular_ELIMINADA() {
    console.warn('‚ö†Ô∏è Funci√≥n obsoleta. Usar toggleVista3D() del threeDMapService');
    return;
    /* C√ìDIGO CONFLICTIVO REMOVIDO PARA UNIFICACI√ìN 3D
            
            // Crear contenedor flotante para la vista 3D
            let container = document.getElementById('vista3DContainer');
            if (!container) {
                container = document.createElement('div');
                container.id = 'vista3DContainer';
                container.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    width: 400px;
                    height: 320px;
                    background: #001133;
                    border: 2px solid #00ff00;
                    border-radius: 8px;
                    z-index: 1000;
                    box-shadow: 0 4px 20px rgba(0,255,0,0.3);
                `;
                
                container.innerHTML = `
                    <div style="padding: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="color: #00ff00; margin: 0; font-family: 'Courier New', monospace;">üéÆ Vista 3D</h4>
                            <button onclick="cerrarVista3DModular()" style="background: rgba(255,0,0,0.2); border: 1px solid #ff6666; color: #ff6666; padding: 4px 8px; border-radius: 4px; cursor: pointer;">‚úï</button>
                        </div>
                        <canvas id="canvas-3d-flotante" width="380" height="260" style="border-radius: 4px; background: #000;"></canvas>
                    </div>
                `;
                
                document.body.appendChild(container);
            }
            
            // Inicializar sistema 3D modular
            await inicializarSistema3D('canvas-3d-flotante', {
                iluminacion: {
                    ambiente: { intensidad: 1.2 },
                    direccional: { intensidad: 1.5 }
                }
            });
            
            // Cargar algunos modelos de ejemplo
            try {
                // Cargar formaci√≥n t√°ctica completa para planeamiento
                await window.sistema3D.cargarFormacionTactica();
                
                // Configurar navegaci√≥n para planeamiento
                window.sistema3D.configurarNavegacionTactica();
                
                console.log('‚úÖ Vista 3D modular activada con formaci√≥n t√°ctica completa');
            } catch (error) {
                console.warn('‚ö†Ô∏è Error cargando formaci√≥n t√°ctica, usando placeholders b√°sicos');
                
                // Fallback a modelos b√°sicos
                const modelosBasicos = [
                    { id: 'tam_tank', posicion: { x: 0, y: 0, z: 0 } },
                    { id: 'sk105', posicion: { x: 5, y: 0, z: 0 } },
                    { id: 'm113', posicion: { x: -5, y: 0, z: 0 } }
                ];
                
                await window.sistema3D.cargarFormacion(modelosBasicos);
                console.log('‚úÖ Vista 3D con modelos b√°sicos activada');
            }
            
        } else {
            // Ya est√° activa, cerrar
            cerrarVista3DModular();
        }
        
    } catch (error) {
        console.error('‚ùå Error en vista 3D modular:', error);
        alert(`‚ùå Error activando vista 3D: ${error.message}`);
    }
}

window.cerrarVista3DModular = function() {
    const container = document.getElementById('vista3DContainer');
    if (container) {
        container.remove();
    }
    
    if (window.sistema3D) {
        window.sistema3D.limpiarEscena();
        window.sistema3D = null;
    }
    
    const btnVista3D = document.getElementById('btnVista3D');
    if (btnVista3D) {
        btnVista3D.innerHTML = '<i class="fas fa-cube"></i> Vista 3D';
    }
    
    */ // FIN C√ìDIGO ELIMINADO
}

// ‚úÖ SISTEMA 3D UNIFICADO COMPLETO - Solo threeDMapService activo

async function descargarDetectorGestos() {
    const btnControlGestos = document.getElementById('btnControlGestos');
    
    try {
        const confirmacion = confirm(
            'ü§ö MAIRA Detector de Gestos\n\n' +
            '¬øDeseas descargar e instalar el detector de gestos en tu PC?\n\n' +
            '‚úÖ Control por gestos para cualquier programa\n' +
            '‚úÖ Mesa de proyecci√≥n interactiva\n' +
            '‚úÖ Integraci√≥n con MAIRA Web\n\n' +
            'Se descargar√° un archivo ZIP con instalador autom√°tico.'
        );
        
        if (!confirmacion) return;
        
        const mensajeOriginal = btnControlGestos.innerHTML;
        btnControlGestos.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Descargando...';
        btnControlGestos.disabled = true;
        
        const response = await fetch('/api/download-gesture-detector');
        
        if (!response.ok) {
            throw new Error(`Error en descarga: ${response.status}`);
        }
        
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'MAIRA_Detector_Gestos.zip';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        setTimeout(() => {
            alert(
                'üì¶ ¬°Descarga completada!\n\n' +
                'üìã Pr√≥ximos pasos:\n' +
                '1. Busca el archivo "MAIRA_Detector_Gestos.zip" en Descargas\n' +
                '2. Extrae el archivo ZIP\n' +
                '3. Ejecuta "maira_gestos.py" (doble click)\n' +
                '4. Sigue las instrucciones en pantalla\n\n' +
                'üí° El detector funcionar√° con MAIRA y cualquier otro programa.'
            );
        }, 500);
        
    } catch (error) {
        console.error('Error descargando detector de gestos:', error);
        alert('‚ùå Error al descargar el detector de gestos.\nVerifica tu conexi√≥n e intenta nuevamente.');
    } finally {
        if (btnControlGestos) {
            btnControlGestos.innerHTML = mensajeOriginal;
            btnControlGestos.disabled = false;
        }
    }
}
</script>

</main>
</body>

</html>