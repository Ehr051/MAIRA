<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculador PCR - Poder de Combate Relativo</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS Custom -->
    <link rel="stylesheet" href="css/calculador.css">
</head>
<body>
    <!-- Header -->
    <header class="bg-dark text-white py-3">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1><i class="fas fa-calculator"></i> Calculador PCR</h1>
                    <p class="mb-0">Poder de Combate Relativo</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <button class="btn btn-outline-light me-2" onclick="limpiarTodo()">
                        <i class="fas fa-trash"></i> Limpiar
                    </button>

                    <!-- Dropdown Exportar -->
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-outline-light dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="exportarJSON(); return false;">
                                <i class="fas fa-file-code"></i> Exportar JSON
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="exportarExcel(); return false;">
                                <i class="fas fa-file-excel"></i> Exportar Excel
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="exportarPDF(); return false;">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </a></li>
                        </ul>
                    </div>

                    <button class="btn btn-outline-light" onclick="window.location.href='../'">
                        <i class="fas fa-home"></i> Inicio
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container-fluid mt-4">
        <!-- Resultado PCR Principal -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card resultado-principal">
                    <div class="card-body text-center">
                        <h2 class="mb-3">PODER DE COMBATE RELATIVO (PCR)</h2>
                        <div class="pcr-display" id="pcrDisplay">
                            <div class="pcr-valor" id="pcrValor">-- : --</div>
                            <div class="pcr-ratio" id="pcrRatio"></div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="total-bando azul">
                                    <h5><i class="fas fa-shield-alt"></i> TOTAL AZULES</h5>
                                    <div class="total-valor" id="totalAzul">0</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="total-bando rojo">
                                    <h5><i class="fas fa-shield-alt"></i> TOTAL COLORADOS</h5>
                                    <div class="total-valor" id="totalRojo">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tablas de Fuerzas -->
        <div class="row">
            <!-- FUERZA AZUL -->
            <div class="col-xl-6 mb-4">
                <div class="card fuerza-card azul">
                    <div class="card-header">
                        <h3><i class="fas fa-flag"></i> FUERZA AZUL</h3>
                        <button class="btn btn-sm btn-primary" onclick="mostrarModalAgregar('azul')">
                            <i class="fas fa-plus"></i> Agregar Elemento
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Factores Globales Azul -->
                        <div class="factores-globales mb-3">
                            <h6>Factores Globales:</h6>
                            <div class="row">
                                <div class="col-md-4 mb-2">
                                    <label>Moral:</label>
                                    <select class="form-select form-select-sm" id="moralAzul" onchange="calcularTotales()">
                                        <option value="1">Normal (1)</option>
                                        <option value="2">Muy Alta (2)</option>
                                        <option value="1.5">Alta (1.5)</option>
                                        <option value="0.5">Baja (0.5)</option>
                                        <option value="0.2">Muy Baja (0.2)</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <label>Experiencia:</label>
                                    <select class="form-select form-select-sm" id="experienciaAzul" onchange="calcularTotales()">
                                        <option value="1">Comb. Ofensivo (1)</option>
                                        <option value="0.5">Comb. Defensivo (0.5)</option>
                                        <option value="0.1">Sin Experiencia (0.1)</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <label>Personal:</label>
                                    <select class="form-select form-select-sm" id="personalAzul" onchange="calcularTotales()">
                                        <option value="1">Profesional 100% (1)</option>
                                        <option value="0.75">75% Perm. 25% Movil. (0.75)</option>
                                        <option value="0.5">50% Perm. 50% Movil. (0.5)</option>
                                        <option value="0.5">Conscripta (0.5)</option>
                                        <option value="0.375">Conscripta 2 años (0.375)</option>
                                        <option value="0.1">100% Movilizado (0.1)</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <label>Oportunidad:</label>
                                    <select class="form-select form-select-sm" id="oportunidadAzul" onchange="calcularTotales()">
                                        <option value="1">Diurno (1)</option>
                                        <option value="0.5">Diurno baja visibilidad (0.5)</option>
                                        <option value="0.25">Nocturno sin capacidad (0.25)</option>
                                        <option value="0.5">Nocturno con instrucción (0.5)</option>
                                        <option value="0.75">Nocturno + amplificador luz (0.75)</option>
                                        <option value="1">Nocturno + visión térmica (1)</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <label>Adaptación Terreno:</label>
                                    <select class="form-select form-select-sm" id="adaptacionAzul" onchange="calcularTotales()">
                                        <option value="1">Con capacitación (1)</option>
                                        <option value="0.9">Llanura sin capacitación (0.9)</option>
                                        <option value="0.5">Monte sin capacitación (0.5)</option>
                                        <option value="0.5">Baja Montaña sin cap. (0.5)</option>
                                        <option value="0.25">Media Montaña sin cap. (0.25)</option>
                                        <option value="0.1">Alta Montaña sin cap. (0.1)</option>
                                        <option value="0.8">Desierto sin capacitación (0.8)</option>
                                        <option value="0.3">Urbano sin capacitación (0.3)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Tabla de elementos -->
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>Equipamiento</th>
                                        <th width="80">Cant.</th>
                                        <th width="60">VRC</th>
                                        <th width="80">Total</th>
                                        <th width="50"></th>
                                    </tr>
                                </thead>
                                <tbody id="tablaAzul">
                                    <tr class="tabla-vacia">
                                        <td colspan="5" class="text-center text-muted">
                                            <i class="fas fa-inbox"></i> No hay elementos agregados
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FUERZA ROJA -->
            <div class="col-xl-6 mb-4">
                <div class="card fuerza-card rojo">
                    <div class="card-header">
                        <h3><i class="fas fa-flag"></i> FUERZA COLORADA</h3>
                        <button class="btn btn-sm btn-danger" onclick="mostrarModalAgregar('rojo')">
                            <i class="fas fa-plus"></i> Agregar Elemento
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Factores Globales Rojo -->
                        <div class="factores-globales mb-3">
                            <h6>Factores Globales:</h6>
                            <div class="row">
                                <div class="col-md-4 mb-2">
                                    <label>Moral:</label>
                                    <select class="form-select form-select-sm" id="moralRojo" onchange="calcularTotales()">
                                        <option value="1">Normal (1)</option>
                                        <option value="2">Muy Alta (2)</option>
                                        <option value="1.5">Alta (1.5)</option>
                                        <option value="0.5">Baja (0.5)</option>
                                        <option value="0.2">Muy Baja (0.2)</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <label>Experiencia:</label>
                                    <select class="form-select form-select-sm" id="experienciaRojo" onchange="calcularTotales()">
                                        <option value="1">Comb. Ofensivo (1)</option>
                                        <option value="0.5">Comb. Defensivo (0.5)</option>
                                        <option value="0.1">Sin Experiencia (0.1)</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <label>Personal:</label>
                                    <select class="form-select form-select-sm" id="personalRojo" onchange="calcularTotales()">
                                        <option value="1">Profesional 100% (1)</option>
                                        <option value="0.75">75% Perm. 25% Movil. (0.75)</option>
                                        <option value="0.5">50% Perm. 50% Movil. (0.5)</option>
                                        <option value="0.5">Conscripta (0.5)</option>
                                        <option value="0.375">Conscripta 2 años (0.375)</option>
                                        <option value="0.1">100% Movilizado (0.1)</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <label>Oportunidad:</label>
                                    <select class="form-select form-select-sm" id="oportunidadRojo" onchange="calcularTotales()">
                                        <option value="1">Diurno (1)</option>
                                        <option value="0.5">Diurno baja visibilidad (0.5)</option>
                                        <option value="0.25">Nocturno sin capacidad (0.25)</option>
                                        <option value="0.5">Nocturno con instrucción (0.5)</option>
                                        <option value="0.75">Nocturno + amplificador luz (0.75)</option>
                                        <option value="1">Nocturno + visión térmica (1)</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <label>Adaptación Terreno:</label>
                                    <select class="form-select form-select-sm" id="adaptacionRojo" onchange="calcularTotales()">
                                        <option value="1">Con capacitación (1)</option>
                                        <option value="0.9">Llanura sin capacitación (0.9)</option>
                                        <option value="0.5">Monte sin capacitación (0.5)</option>
                                        <option value="0.5">Baja Montaña sin cap. (0.5)</option>
                                        <option value="0.25">Media Montaña sin cap. (0.25)</option>
                                        <option value="0.1">Alta Montaña sin cap. (0.1)</option>
                                        <option value="0.8">Desierto sin capacitación (0.8)</option>
                                        <option value="0.3">Urbano sin capacitación (0.3)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Tabla de elementos -->
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>Equipamiento</th>
                                        <th width="80">Cant.</th>
                                        <th width="60">VRC</th>
                                        <th width="80">Total</th>
                                        <th width="50"></th>
                                    </tr>
                                </thead>
                                <tbody id="tablaRojo">
                                    <tr class="tabla-vacia">
                                        <td colspan="5" class="text-center text-muted">
                                            <i class="fas fa-inbox"></i> No hay elementos agregados
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Elemento -->
    <div class="modal fade" id="modalAgregar" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Elemento - <span id="modalBandoTitle"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Categoría:</label>
                            <select class="form-select" id="categoriaSelect" onchange="cargarEquipamiento()">
                                <option value="">Seleccione...</option>
                                <option value="maniobra">Elementos de Maniobra</option>
                                <option value="apoyoFuego">Apoyo de Fuego</option>
                                <option value="ingenieros">Ingenieros</option>
                                <option value="comunicaciones">Comunicaciones y GE</option>
                                <option value="toe">TOE (Tropas de Operaciones Especiales)</option>
                                <option value="otros">Otros... (Personalizado)</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Equipamiento:</label>
                            <select class="form-select" id="equipamientoSelect" onchange="mostrarInfoEquipamiento()">
                                <option value="">Primero seleccione una categoría</option>
                            </select>
                        </div>
                    </div>

                    <!-- Info del equipamiento seleccionado -->
                    <div id="infoEquipamiento" class="alert alert-info d-none">
                        <h6>Información:</h6>
                        <p id="infoObs"></p>
                        <p><strong>VRC Base:</strong> <span id="infoVRC"></span></p>
                    </div>

                    <!-- Campos para elementos personalizados -->
                    <div id="camposPersonalizados" class="d-none">
                        <div class="alert alert-warning">
                            <strong>Elemento Personalizado:</strong> Complete los datos del elemento.
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre del Elemento:</label>
                                <input type="text" class="form-control" id="nombrePersonalizado" placeholder="Ej: Ca Esp Reconocimiento">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">VRC:</label>
                                <input type="number" class="form-control" id="vrcPersonalizado" min="0" step="0.01" placeholder="0.00">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Mun. Inteligente:</label>
                                <div class="form-check form-switch mt-2">
                                    <input class="form-check-input" type="checkbox" id="munIntPersonalizado">
                                    <label class="form-check-label">Sí</label>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Observaciones (opcional):</label>
                            <input type="text" class="form-control" id="obsPersonalizado" placeholder="Ej: Con equipamiento especial">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Cantidad:</label>
                            <input type="number" class="form-control" id="cantidadInput" min="1" value="1">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Con Munición Inteligente:</label>
                            <div class="form-check form-switch mt-2">
                                <input class="form-check-input" type="checkbox" id="munIntCheckbox" disabled>
                                <label class="form-check-label">Multiplicar VRC x 1.5</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="agregarElemento()">
                        <i class="fas fa-plus"></i> Agregar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Librerías para Exportación -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="js/datos-equipamiento.js"></script>
    <script src="js/calculador.js"></script>
</body>
</html>
