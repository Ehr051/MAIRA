<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä MAIRA - Estado del Sistema y Pr√≥ximos Pasos</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #0f0f23);
            color: #ffffff;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(0,0,0,0.8);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,255,0,0.3);
            border: 3px solid #00ff00;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #00ff00;
            padding-bottom: 30px;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }
        .status-card {
            background: rgba(0,40,0,0.9);
            border: 2px solid #00ff00;
            padding: 25px;
            border-radius: 15px;
            transition: all 0.3s ease;
        }
        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,255,0,0.4);
        }
        .status-completed { border-color: #00ff00; background: rgba(0,60,0,0.9); }
        .status-pending { border-color: #ffaa00; background: rgba(60,40,0,0.9); }
        .status-critical { border-color: #ff4444; background: rgba(60,0,0,0.9); }
        
        .progress-section {
            background: rgba(0,20,0,0.8);
            border: 2px solid #00ff00;
            margin: 30px 0;
            padding: 30px;
            border-radius: 15px;
        }
        .progress-bar {
            background: #333;
            border-radius: 15px;
            padding: 4px;
            margin: 15px 0;
        }
        .progress-fill {
            background: linear-gradient(90deg, #00ff00, #00aa00);
            height: 25px;
            border-radius: 12px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
        }
        .btn {
            background: linear-gradient(45deg, #00ff00, #00aa00);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin: 8px;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: linear-gradient(45deg, #00aa00, #007700);
            transform: scale(1.05);
        }
        .btn.warning { background: linear-gradient(45deg, #ffaa00, #ff8800); }
        .btn.critical { background: linear-gradient(45deg, #ff4444, #cc0000); color: #fff; }
        
        .emoji { font-size: 1.5em; margin-right: 10px; }
        .large-emoji { font-size: 3em; display: block; text-align: center; margin: 20px 0; }
        
        .next-steps {
            background: rgba(0,0,60,0.8);
            border: 2px solid #0088ff;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }
        
        .cost-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .cost-table th, .cost-table td {
            border: 1px solid #333;
            padding: 12px;
            text-align: left;
        }
        .cost-table th {
            background: rgba(0,60,0,0.8);
            color: #00ff00;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä MAIRA - Estado del Sistema</h1>
            <p>Dashboard completo del progreso de correcciones y pr√≥ximos pasos</p>
            <div id="overallStatus" class="large-emoji">üîÑ</div>
        </div>

        <!-- Progreso General -->
        <div class="progress-section">
            <h2>üéØ Progreso General de Correcciones</h2>
            <div class="progress-bar">
                <div id="generalProgress" class="progress-fill" style="width: 75%">75% Completado</div>
            </div>
            <p><strong>Estado:</strong> <span id="generalStatusText">Sistema parcialmente funcional - requiere almacenamiento externo</span></p>
        </div>

        <!-- Estado de Componentes -->
        <div class="status-grid">
            <!-- Archivos JavaScript -->
            <div class="status-card status-completed">
                <h3><span class="emoji">‚úÖ</span>Archivos JavaScript</h3>
                <p><strong>Estado:</strong> COMPLETADO</p>
                <ul>
                    <li>‚úÖ elevationHandler.js - Subido al repo</li>
                    <li>‚úÖ vegetacionhandler.js - Subido al repo</li>
                    <li>‚úÖ networkConfig.js - Funcionando</li>
                    <li>‚úÖ Correcciones 502 - Activas</li>
                </ul>
                <button class="btn" onclick="window.open('verificacion_post_deploy.html', '_blank')">üìä Verificar</button>
            </div>

            <!-- Variables de Configuraci√≥n -->
            <div class="status-card status-completed">
                <h3><span class="emoji">‚úÖ</span>Variables de Configuraci√≥n</h3>
                <p><strong>Estado:</strong> FUNCIONANDO</p>
                <ul>
                    <li>‚úÖ NetworkConfig variables definidas</li>
                    <li>‚úÖ Detecci√≥n autom√°tica de entorno</li>
                    <li>‚úÖ Fallbacks de emergencia</li>
                    <li>‚úÖ Correcciones post-verificaci√≥n</li>
                </ul>
                <button class="btn" onclick="window.open('test_integral_correcciones.html', '_blank')">üß™ Test</button>
            </div>

            <!-- Bibliotecas CDN -->
            <div class="status-card status-pending">
                <h3><span class="emoji">‚ö†Ô∏è</span>Bibliotecas CDN</h3>
                <p><strong>Estado:</strong> PENDIENTE</p>
                <ul>
                    <li>‚ö†Ô∏è Leaflet - Carga autom√°tica implementada</li>
                    <li>‚ö†Ô∏è MilSymbol - Fallback disponible</li>
                    <li>‚ö†Ô∏è D3.js - Carga condicional</li>
                    <li>‚úÖ Correcciones autom√°ticas activas</li>
                </ul>
                <button class="btn warning" onclick="forceLoadLibraries()">‚ö° Forzar Carga</button>
            </div>

            <!-- Datos Geogr√°ficos -->
            <div class="status-card status-critical">
                <h3><span class="emoji">üö®</span>Datos Geogr√°ficos</h3>
                <p><strong>Estado:</strong> CR√çTICO - Requiere migraci√≥n</p>
                <ul>
                    <li>üö® 6.3GB de tiles (demasiado para GitHub)</li>
                    <li>üö® 5,516 archivos TIF no disponibles</li>
                    <li>‚úÖ Plan de migraci√≥n creado</li>
                    <li>‚úÖ Adaptador externo listo</li>
                </ul>
                <button class="btn critical" onclick="window.open('AWS_S3_SETUP_GUIDE.md', '_blank')">‚òÅÔ∏è Migrar a S3</button>
            </div>
        </div>

        <!-- Pr√≥ximos Pasos Cr√≠ticos -->
        <div class="next-steps">
            <h2><span class="emoji">üéØ</span>Pr√≥ximos Pasos Cr√≠ticos</h2>
            
            <h3>1. üö® URGENTE: Configurar Almacenamiento Externo</h3>
            <p><strong>Problema:</strong> Las tiles geogr√°ficas (6.3GB) no pueden almacenarse en GitHub/Render</p>
            <p><strong>Soluci√≥n:</strong> Migrar a almacenamiento en la nube</p>
            
            <table class="cost-table">
                <tr>
                    <th>Opci√≥n</th>
                    <th>Costo/Mes</th>
                    <th>Pros</th>
                    <th>Contras</th>
                </tr>
                <tr>
                    <td>AWS S3 + CloudFront</td>
                    <td>$7-15</td>
                    <td>R√°pido, confiable, CDN global</td>
                    <td>Requiere configuraci√≥n inicial</td>
                </tr>
                <tr>
                    <td>Google Cloud Storage</td>
                    <td>$8-12</td>
                    <td>F√°cil setup, CDN incluido</td>
                    <td>Menos opciones de configuraci√≥n</td>
                </tr>
                <tr>
                    <td>GitHub LFS</td>
                    <td>$5</td>
                    <td>Integrado con repo</td>
                    <td>Limitaciones de ancho de banda</td>
                </tr>
            </table>

            <div style="margin: 20px 0;">
                <button class="btn" onclick="window.open('AWS_S3_SETUP_GUIDE.md', '_blank')">‚òÅÔ∏è Setup AWS S3</button>
                <button class="btn" onclick="window.open('PLAN_ALMACENAMIENTO_TILES.md', '_blank')">üìã Ver Plan Completo</button>
                <button class="btn warning" onclick="runMigrationScript()">üîß Ejecutar Migraci√≥n</button>
            </div>

            <h3>2. ‚ö° Acciones Inmediatas</h3>
            <ul>
                <li><strong>Para Testing:</strong> Usar modo fallback local en desarrollo</li>
                <li><strong>Para Producci√≥n:</strong> Configurar S3 antes del pr√≥ximo deploy</li>
                <li><strong>Para Usuarios:</strong> Mostrar mensaje sobre datos geogr√°ficos temporalmente no disponibles</li>
            </ul>

            <h3>3. üîß Monitoreo Continuo</h3>
            <ul>
                <li>Verificar logs de correcciones autom√°ticas</li>
                <li>Monitorear carga de bibliotecas CDN</li>
                <li>Validar funcionamiento de handlers JS</li>
                <li>Preparar rollback en caso de problemas</li>
            </ul>
        </div>

        <!-- Enlaces R√°pidos -->
        <div class="status-grid">
            <div class="status-card">
                <h3><span class="emoji">üîó</span>Enlaces R√°pidos</h3>
                <button class="btn" onclick="window.open('planeamiento.html', '_blank')">üìã Planeamiento</button>
                <button class="btn" onclick="window.open('juegodeguerra.html', '_blank')">‚öîÔ∏è Juego Guerra</button>
                <button class="btn" onclick="window.open('test_integral_correcciones.html', '_blank')">üß™ Test Integral</button>
                <button class="btn" onclick="window.open('diagnostico_servidor.html', '_blank')">ü©∫ Diagn√≥stico</button>
            </div>

            <div class="status-card">
                <h3><span class="emoji">üìÅ</span>Documentaci√≥n</h3>
                <button class="btn" onclick="window.open('PLAN_ALMACENAMIENTO_TILES.md', '_blank')">üìä Plan Almacenamiento</button>
                <button class="btn" onclick="window.open('AWS_S3_SETUP_GUIDE.md', '_blank')">‚òÅÔ∏è Setup AWS</button>
                <button class="btn" onclick="window.open('DEPLOYMENT_SUCCESS.md', '_blank')">üöÄ Deploy Guide</button>
            </div>
        </div>

        <!-- Log de Acciones -->
        <div class="progress-section">
            <h3>üìã Log de Acciones Recientes</h3>
            <div id="actionLog" style="background: #000; padding: 20px; border-radius: 10px; height: 200px; overflow-y: auto; font-family: monospace;">
                <div>‚úÖ [12:30] Archivos JS cr√≠ticos subidos al repositorio</div>
                <div>‚úÖ [12:31] Correcciones 502 desplegadas y funcionando</div>
                <div>‚úÖ [12:32] Sistema de verificaci√≥n post-deploy creado</div>
                <div>‚ö†Ô∏è [12:33] Problema de almacenamiento identificado (6.3GB)</div>
                <div>‚úÖ [12:34] Plan de migraci√≥n a almacenamiento externo creado</div>
                <div>‚úÖ [12:35] Adaptador para tiles externas implementado</div>
                <div>üìä [12:36] Estado actual: 75% funcional, pendiente migraci√≥n de datos</div>
            </div>
        </div>
    </div>

    <script>
        // Funci√≥n para forzar carga de bibliotecas
        function forceLoadLibraries() {
            if (window.correccionesPostVerificacion) {
                window.correccionesPostVerificacion.verificarBibliotecasCDN();
                addLogEntry('‚ö° Forzando carga de bibliotecas CDN...');
                setTimeout(() => {
                    addLogEntry('‚úÖ Bibliotecas CDN cargadas');
                    updateLibraryStatus();
                }, 3000);
            } else {
                addLogEntry('‚ùå Correcciones post-verificaci√≥n no disponibles');
            }
        }

        // Funci√≥n para ejecutar script de migraci√≥n
        function runMigrationScript() {
            addLogEntry('üîß Preparando migraci√≥n de tiles...');
            addLogEntry('‚ÑπÔ∏è Execute: ./tiles_to_external_storage.sh');
            addLogEntry('üìÅ Archivos preparados en external_storage/');
            addLogEntry('‚è≥ Seleccione proveedor de almacenamiento (AWS S3 recomendado)');
        }

        // Funci√≥n para agregar entradas al log
        function addLogEntry(message) {
            const log = document.getElementById('actionLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // Actualizar estado de bibliotecas
        function updateLibraryStatus() {
            const hasLeaflet = typeof L !== 'undefined';
            const hasMilSymbol = typeof ms !== 'undefined';
            const hasD3 = typeof d3 !== 'undefined';
            
            const total = 3;
            const loaded = [hasLeaflet, hasMilSymbol, hasD3].filter(Boolean).length;
            const percentage = Math.round((loaded / total) * 100);
            
            if (percentage === 100) {
                addLogEntry('‚úÖ Todas las bibliotecas CDN cargadas correctamente');
            } else {
                addLogEntry(`‚ö†Ô∏è Bibliotecas CDN: ${loaded}/${total} cargadas (${percentage}%)`);
            }
        }

        // Actualizar progreso general
        function updateGeneralProgress() {
            const jsFiles = true; // ‚úÖ Completado
            const config = true;  // ‚úÖ Completado
            const libraries = typeof L !== 'undefined' && typeof ms !== 'undefined' && typeof d3 !== 'undefined'; // Variable
            const tiles = false;  // üö® Pendiente migraci√≥n
            
            const components = [jsFiles, config, libraries, tiles];
            const completed = components.filter(Boolean).length;
            const percentage = Math.round((completed / components.length) * 100);
            
            document.getElementById('generalProgress').style.width = percentage + '%';
            document.getElementById('generalProgress').textContent = percentage + '% Completado';
            
            if (percentage === 100) {
                document.getElementById('overallStatus').textContent = '‚úÖ';
                document.getElementById('generalStatusText').textContent = 'Sistema completamente funcional';
            } else if (percentage >= 75) {
                document.getElementById('overallStatus').textContent = '‚ö†Ô∏è';
                document.getElementById('generalStatusText').textContent = 'Sistema mayormente funcional - migraci√≥n de datos pendiente';
            } else {
                document.getElementById('overallStatus').textContent = 'üö®';
                document.getElementById('generalStatusText').textContent = 'Sistema requiere atenci√≥n urgente';
            }
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            addLogEntry('üìä Dashboard de estado iniciado');
            updateGeneralProgress();
            
            // Verificar bibliotecas cada 5 segundos
            setInterval(updateGeneralProgress, 5000);
        });

        // Cargar scripts de correcci√≥n si est√°n disponibles
        const scripts = [
            'correcciones_servidor_502.js',
            'correcciones_post_verificacion.js',
            'external_tiles_adapter.js'
        ];

        scripts.forEach(script => {
            const scriptElement = document.createElement('script');
            scriptElement.src = script;
            scriptElement.onerror = () => addLogEntry(`‚ö†Ô∏è No se pudo cargar ${script}`);
            scriptElement.onload = () => addLogEntry(`‚úÖ Cargado ${script}`);
            document.head.appendChild(scriptElement);
        });
    </script>
</body>
</html>
